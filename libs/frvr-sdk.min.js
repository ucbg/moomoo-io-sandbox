!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=function(t){return t&&t.Math==Math&&t},r=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),n="object"==typeof document&&document.all,o={all:n,IS_HTMLDDA:void 0===n&&void 0!==n},i=o.all,u=o.IS_HTMLDDA?function(t){return"function"==typeof t||t===i}:function(t){return"function"==typeof t},a=u,c=o.all,f=o.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:a(t)||t===c}:function(t){return"object"==typeof t?null!==t:a(t)},s=f,l=r.document,p=s(l)&&s(l.createElement),v=function(t){return p?l.createElement(t):{}},h=v("span").classList,y=h&&h.constructor&&h.constructor.prototype,d=y===Object.prototype?void 0:y,g=function(t){try{return!!t()}catch(t){return!0}},b=!g((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),m=b,S=Function.prototype,w=S.call,O=m&&S.bind.bind(w,w),x=m?O:function(t){return function(){return w.apply(t,arguments)}},R=x,E=R({}.toString),j=R("".slice),T=function(t){return j(E(t),8,-1)},I=g,P=T,L=Object,A=x("".split),k=I((function(){return!L("z").propertyIsEnumerable(0)}))?function(t){return"String"==P(t)?A(t,""):L(t)}:L,C=function(t){return null==t},_=C,U=TypeError,M=function(t){if(_(t))throw U("Can't call method on "+t);return t},D=k,F=M,N=function(t){return D(F(t))},G={exports:{}},$=r,z=Object.defineProperty,B=function(t,e){try{z($,t,{value:e,configurable:!0,writable:!0})}catch(r){$[t]=e}return e},V=B,H="__core-js_shared__",q=r[H]||V(H,{}),W=q;(G.exports=function(t,e){return W[t]||(W[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.31.1",mode:"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Y,K,Q=M,X=Object,J=function(t){return X(Q(t))},Z=J,tt=x({}.hasOwnProperty),et=Object.hasOwn||function(t,e){return tt(Z(t),e)},rt=x,nt=0,ot=Math.random(),it=rt(1..toString),ut=function(t){return"Symbol("+(void 0===t?"":t)+")_"+it(++nt+ot,36)},at=r,ct="undefined"!=typeof navigator&&String(navigator.userAgent)||"",ft=at.process,st=at.Deno,lt=ft&&ft.versions||st&&st.version,pt=lt&&lt.v8;pt&&(K=(Y=pt.split("."))[0]>0&&Y[0]<4?1:+(Y[0]+Y[1])),!K&&ct&&(!(Y=ct.match(/Edge\/(\d+)/))||Y[1]>=74)&&(Y=ct.match(/Chrome\/(\d+)/))&&(K=+Y[1]);var vt=K,ht=vt,yt=g,dt=r.String,gt=!!Object.getOwnPropertySymbols&&!yt((function(){var t=Symbol();return!dt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ht&&ht<41})),bt=gt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,mt=r,St=G.exports,wt=et,Ot=ut,xt=gt,Rt=bt,Et=mt.Symbol,jt=St("wks"),Tt=Rt?Et.for||Et:Et&&Et.withoutSetter||Ot,It=function(t){return wt(jt,t)||(jt[t]=xt&&wt(Et,t)?Et[t]:Tt("Symbol."+t)),jt[t]},Pt=f,Lt=String,At=TypeError,kt=function(t){if(Pt(t))return t;throw At(Lt(t)+" is not an object")},Ct={},_t=!g((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Ut=_t&&g((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Mt={},Dt=v,Ft=!_t&&!g((function(){return 7!=Object.defineProperty(Dt("div"),"a",{get:function(){return 7}}).a})),Nt=b,Gt=Function.prototype.call,$t=Nt?Gt.bind(Gt):function(){return Gt.apply(Gt,arguments)},zt=r,Bt=u,Vt=function(t){return Bt(t)?t:void 0},Ht=function(t,e){return arguments.length<2?Vt(zt[t]):zt[t]&&zt[t][e]},qt=x({}.isPrototypeOf),Wt=Ht,Yt=u,Kt=qt,Qt=Object,Xt=bt?function(t){return"symbol"==typeof t}:function(t){var e=Wt("Symbol");return Yt(e)&&Kt(e.prototype,Qt(t))},Jt=String,Zt=function(t){try{return Jt(t)}catch(t){return"Object"}},te=u,ee=Zt,re=TypeError,ne=function(t){if(te(t))return t;throw re(ee(t)+" is not a function")},oe=ne,ie=C,ue=function(t,e){var r=t[e];return ie(r)?void 0:oe(r)},ae=$t,ce=u,fe=f,se=TypeError,le=$t,pe=f,ve=Xt,he=ue,ye=function(t,e){var r,n;if("string"===e&&ce(r=t.toString)&&!fe(n=ae(r,t)))return n;if(ce(r=t.valueOf)&&!fe(n=ae(r,t)))return n;if("string"!==e&&ce(r=t.toString)&&!fe(n=ae(r,t)))return n;throw se("Can't convert object to primitive value")},de=TypeError,ge=It("toPrimitive"),be=function(t,e){if(!pe(t)||ve(t))return t;var r,n=he(t,ge);if(n){if(void 0===e&&(e="default"),r=le(n,t,e),!pe(r)||ve(r))return r;throw de("Can't convert object to primitive value")}return void 0===e&&(e="number"),ye(t,e)},me=Xt,Se=function(t){var e=be(t,"string");return me(e)?e:e+""},we=_t,Oe=Ft,xe=Ut,Re=kt,Ee=Se,je=TypeError,Te=Object.defineProperty,Ie=Object.getOwnPropertyDescriptor,Pe="enumerable",Le="configurable",Ae="writable";Mt.f=we?xe?function(t,e,r){if(Re(t),e=Ee(e),Re(r),"function"==typeof t&&"prototype"===e&&"value"in r&&Ae in r&&!r.writable){var n=Ie(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:Le in r?r.configurable:n.configurable,enumerable:Pe in r?r.enumerable:n.enumerable,writable:!1})}return Te(t,e,r)}:Te:function(t,e,r){if(Re(t),e=Ee(e),Re(r),Oe)try{return Te(t,e,r)}catch(t){}if("get"in r||"set"in r)throw je("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var ke=Math.ceil,Ce=Math.floor,_e=Math.trunc||function(t){var e=+t;return(e>0?Ce:ke)(e)},Ue=function(t){var e=+t;return e!=e||0===e?0:_e(e)},Me=Ue,De=Math.max,Fe=Math.min,Ne=function(t,e){var r=Me(t);return r<0?De(r+e,0):Fe(r,e)},Ge=Ue,$e=Math.min,ze=function(t){return t>0?$e(Ge(t),9007199254740991):0},Be=ze,Ve=function(t){return Be(t.length)},He=N,qe=Ne,We=Ve,Ye=function(t){return function(e,r,n){var o,i=He(e),u=We(i),a=qe(n,u);if(t&&r!=r){for(;u>a;)if((o=i[a++])!=o)return!0}else for(;u>a;a++)if((t||a in i)&&i[a]===r)return t||a||0;return!t&&-1}},Ke={includes:Ye(!0),indexOf:Ye(!1)},Qe={},Xe=et,Je=N,Ze=Ke.indexOf,tr=Qe,er=x([].push),rr=function(t,e){var r,n=Je(t),o=0,i=[];for(r in n)!Xe(tr,r)&&Xe(n,r)&&er(i,r);for(;e.length>o;)Xe(n,r=e[o++])&&(~Ze(i,r)||er(i,r));return i},nr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],or=rr,ir=nr,ur=Object.keys||function(t){return or(t,ir)},ar=_t,cr=Ut,fr=Mt,sr=kt,lr=N,pr=ur;Ct.f=ar&&!cr?Object.defineProperties:function(t,e){sr(t);for(var r,n=lr(e),o=pr(e),i=o.length,u=0;i>u;)fr.f(t,r=o[u++],n[r]);return t};var vr,hr=Ht("document","documentElement"),yr=G.exports,dr=ut,gr=yr("keys"),br=function(t){return gr[t]||(gr[t]=dr(t))},mr=kt,Sr=Ct,wr=nr,Or=Qe,xr=hr,Rr=v,Er=br("IE_PROTO"),jr=function(){},Tr=function(t){return"<script>"+t+"</"+"script>"},Ir=function(t){t.write(Tr("")),t.close();var e=t.parentWindow.Object;return t=null,e},Pr=function(){try{vr=new ActiveXObject("htmlfile")}catch(t){}var t,e;Pr="undefined"!=typeof document?document.domain&&vr?Ir(vr):((e=Rr("iframe")).style.display="none",xr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Tr("document.F=Object")),t.close(),t.F):Ir(vr);for(var r=wr.length;r--;)delete Pr.prototype[wr[r]];return Pr()};Or[Er]=!0;var Lr=Object.create||function(t,e){var r;return null!==t?(jr.prototype=mr(t),r=new jr,jr.prototype=null,r[Er]=t):r=Pr(),void 0===e?r:Sr.f(r,e)},Ar=It,kr=Lr,Cr=Mt.f,_r=Ar("unscopables"),Ur=Array.prototype;null==Ur[_r]&&Cr(Ur,_r,{configurable:!0,value:kr(null)});var Mr,Dr,Fr,Nr={},Gr=u,$r=r.WeakMap,zr=Gr($r)&&/native code/.test(String($r)),Br=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Vr=Mt,Hr=Br,qr=_t?function(t,e,r){return Vr.f(t,e,Hr(1,r))}:function(t,e,r){return t[e]=r,t},Wr=zr,Yr=r,Kr=f,Qr=qr,Xr=et,Jr=q,Zr=br,tn=Qe,en="Object already initialized",rn=Yr.TypeError,nn=Yr.WeakMap;if(Wr||Jr.state){var on=Jr.state||(Jr.state=new nn);on.get=on.get,on.has=on.has,on.set=on.set,Mr=function(t,e){if(on.has(t))throw rn(en);return e.facade=t,on.set(t,e),e},Dr=function(t){return on.get(t)||{}},Fr=function(t){return on.has(t)}}else{var un=Zr("state");tn[un]=!0,Mr=function(t,e){if(Xr(t,un))throw rn(en);return e.facade=t,Qr(t,un,e),e},Dr=function(t){return Xr(t,un)?t[un]:{}},Fr=function(t){return Xr(t,un)}}var an={set:Mr,get:Dr,has:Fr,enforce:function(t){return Fr(t)?Dr(t):Mr(t,{})},getterFor:function(t){return function(e){var r;if(!Kr(e)||(r=Dr(e)).type!==t)throw rn("Incompatible receiver, "+t+" required");return r}}},cn={},fn={},sn={}.propertyIsEnumerable,ln=Object.getOwnPropertyDescriptor,pn=ln&&!sn.call({1:2},1);fn.f=pn?function(t){var e=ln(this,t);return!!e&&e.enumerable}:sn;var vn=_t,hn=$t,yn=fn,dn=Br,gn=N,bn=Se,mn=et,Sn=Ft,wn=Object.getOwnPropertyDescriptor;cn.f=vn?wn:function(t,e){if(t=gn(t),e=bn(e),Sn)try{return wn(t,e)}catch(t){}if(mn(t,e))return dn(!hn(yn.f,t,e),t[e])};var On={exports:{}},xn=_t,Rn=et,En=Function.prototype,jn=xn&&Object.getOwnPropertyDescriptor,Tn=Rn(En,"name"),In={EXISTS:Tn,PROPER:Tn&&"something"===function(){}.name,CONFIGURABLE:Tn&&(!xn||xn&&jn(En,"name").configurable)},Pn=u,Ln=q,An=x(Function.toString);Pn(Ln.inspectSource)||(Ln.inspectSource=function(t){return An(t)});var kn=Ln.inspectSource,Cn=x,_n=g,Un=u,Mn=et,Dn=_t,Fn=In.CONFIGURABLE,Nn=kn,Gn=an.enforce,$n=an.get,zn=String,Bn=Object.defineProperty,Vn=Cn("".slice),Hn=Cn("".replace),qn=Cn([].join),Wn=Dn&&!_n((function(){return 8!==Bn((function(){}),"length",{value:8}).length})),Yn=String(String).split("String"),Kn=On.exports=function(t,e,r){"Symbol("===Vn(zn(e),0,7)&&(e="["+Hn(zn(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!Mn(t,"name")||Fn&&t.name!==e)&&(Dn?Bn(t,"name",{value:e,configurable:!0}):t.name=e),Wn&&r&&Mn(r,"arity")&&t.length!==r.arity&&Bn(t,"length",{value:r.arity});try{r&&Mn(r,"constructor")&&r.constructor?Dn&&Bn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=Gn(t);return Mn(n,"source")||(n.source=qn(Yn,"string"==typeof e?e:"")),t};Function.prototype.toString=Kn((function(){return Un(this)&&$n(this).source||Nn(this)}),"toString");var Qn=u,Xn=Mt,Jn=On.exports,Zn=B,to=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(Qn(r)&&Jn(r,i,n),n.global)o?t[e]=r:Zn(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Xn.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},eo={},ro=rr,no=nr.concat("length","prototype");eo.f=Object.getOwnPropertyNames||function(t){return ro(t,no)};var oo={};oo.f=Object.getOwnPropertySymbols;var io,uo,ao,co=Ht,fo=eo,so=oo,lo=kt,po=x([].concat),vo=co("Reflect","ownKeys")||function(t){var e=fo.f(lo(t)),r=so.f;return r?po(e,r(t)):e},ho=et,yo=vo,go=cn,bo=Mt,mo=g,So=u,wo=/#|\.prototype\./,Oo=function(t,e){var r=Ro[xo(t)];return r==jo||r!=Eo&&(So(e)?mo(e):!!e)},xo=Oo.normalize=function(t){return String(t).replace(wo,".").toLowerCase()},Ro=Oo.data={},Eo=Oo.NATIVE="N",jo=Oo.POLYFILL="P",To=Oo,Io=r,Po=cn.f,Lo=qr,Ao=to,ko=B,Co=function(t,e,r){for(var n=yo(e),o=bo.f,i=go.f,u=0;u<n.length;u++){var a=n[u];ho(t,a)||r&&ho(r,a)||o(t,a,i(e,a))}},_o=To,Uo=function(t,e){var r,n,o,i,u,a=t.target,c=t.global,f=t.stat;if(r=c?Io:f?Io[a]||ko(a,{}):(Io[a]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(u=Po(r,n))&&u.value:r[n],!_o(c?n:a+(f?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Co(i,o)}(t.sham||o&&o.sham)&&Lo(i,"sham",!0),Ao(r,n,i,t)}},Mo=!g((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Do=et,Fo=u,No=J,Go=Mo,$o=br("IE_PROTO"),zo=Object,Bo=zo.prototype,Vo=Go?zo.getPrototypeOf:function(t){var e=No(t);if(Do(e,$o))return e[$o];var r=e.constructor;return Fo(r)&&e instanceof r?r.prototype:e instanceof zo?Bo:null},Ho=g,qo=u,Wo=f,Yo=Vo,Ko=to,Qo=It("iterator"),Xo=!1;[].keys&&("next"in(ao=[].keys())?(uo=Yo(Yo(ao)))!==Object.prototype&&(io=uo):Xo=!0);var Jo=!Wo(io)||Ho((function(){var t={};return io[Qo].call(t)!==t}));Jo&&(io={}),qo(io[Qo])||Ko(io,Qo,(function(){return this}));var Zo={IteratorPrototype:io,BUGGY_SAFARI_ITERATORS:Xo},ti=Mt.f,ei=et,ri=It("toStringTag"),ni=function(t,e,r){t&&!r&&(t=t.prototype),t&&!ei(t,ri)&&ti(t,ri,{configurable:!0,value:e})},oi=Zo.IteratorPrototype,ii=Lr,ui=Br,ai=ni,ci=Nr,fi=function(){return this},si=function(t,e,r,n){var o=e+" Iterator";return t.prototype=ii(oi,{next:ui(+!n,r)}),ai(t,o,!1),ci[o]=fi,t},li=x,pi=ne,vi=u,hi=String,yi=TypeError,di=function(t,e,r){try{return li(pi(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}},gi=kt,bi=function(t){if("object"==typeof t||vi(t))return t;throw yi("Can't set "+hi(t)+" as a prototype")},mi=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=di(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return gi(r),bi(n),e?t(r,n):r.__proto__=n,r}}():void 0),Si=Uo,wi=$t,Oi=u,xi=si,Ri=Vo,Ei=mi,ji=ni,Ti=qr,Ii=to,Pi=Nr,Li=In.PROPER,Ai=In.CONFIGURABLE,ki=Zo.IteratorPrototype,Ci=Zo.BUGGY_SAFARI_ITERATORS,_i=It("iterator"),Ui="keys",Mi="values",Di="entries",Fi=function(){return this},Ni=N,Gi=function(t){Ur[_r][t]=!0},$i=Nr,zi=an,Bi=Mt.f,Vi=function(t,e,r,n,o,i,u){xi(r,e,n);var a,c,f,s=function(t){if(t===o&&y)return y;if(!Ci&&t in v)return v[t];switch(t){case Ui:case Mi:case Di:return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",p=!1,v=t.prototype,h=v[_i]||v["@@iterator"]||o&&v[o],y=!Ci&&h||s(o),d="Array"==e&&v.entries||h;if(d&&(a=Ri(d.call(new t)))!==Object.prototype&&a.next&&(Ri(a)!==ki&&(Ei?Ei(a,ki):Oi(a[_i])||Ii(a,_i,Fi)),ji(a,l,!0)),Li&&o==Mi&&h&&h.name!==Mi&&(Ai?Ti(v,"name",Mi):(p=!0,y=function(){return wi(h,this)})),o)if(c={values:s(Mi),keys:i?y:s(Ui),entries:s(Di)},u)for(f in c)(Ci||p||!(f in v))&&Ii(v,f,c[f]);else Si({target:e,proto:!0,forced:Ci||p},c);return v[_i]!==y&&Ii(v,_i,y,{name:o}),Pi[e]=y,c},Hi=function(t,e){return{value:t,done:e}},qi=_t,Wi="Array Iterator",Yi=zi.set,Ki=zi.getterFor(Wi),Qi=Vi(Array,"Array",(function(t,e){Yi(this,{type:Wi,target:Ni(t),index:0,kind:e})}),(function(){var t=Ki(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Hi(void 0,!0)):Hi("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Xi=$i.Arguments=$i.Array;if(Gi("keys"),Gi("values"),Gi("entries"),qi&&"values"!==Xi.name)try{Bi(Xi,"name",{value:"values"})}catch(t){}var Ji=r,Zi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},tu=d,eu=Qi,ru=qr,nu=It,ou=nu("iterator"),iu=nu("toStringTag"),uu=eu.values,au=function(t,e){if(t){if(t[ou]!==uu)try{ru(t,ou,uu)}catch(e){t[ou]=uu}if(t[iu]||ru(t,iu,e),Zi[e])for(var r in eu)if(t[r]!==eu[r])try{ru(t,r,eu[r])}catch(e){t[r]=eu[r]}}};for(var cu in Zi)au(Ji[cu]&&Ji[cu].prototype,cu);au(tu,"DOMTokenList");var fu=b,su=Function.prototype,lu=su.apply,pu=su.call,vu="object"==typeof Reflect&&Reflect.apply||(fu?pu.bind(lu):function(){return pu.apply(lu,arguments)}),hu={};hu[It("toStringTag")]="z";var yu,du,gu="[object z]"===String(hu),bu=u,mu=T,Su=It("toStringTag"),wu=Object,Ou="Arguments"==mu(function(){return arguments}()),xu=gu?mu:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=wu(t),Su))?r:Ou?mu(e):"Object"==(n=mu(e))&&bu(e.callee)?"Arguments":n},Ru=xu,Eu=String,ju=function(t){if("Symbol"===Ru(t))throw TypeError("Cannot convert a Symbol value to a string");return Eu(t)},Tu=kt,Iu=g,Pu=r.RegExp,Lu=Iu((function(){var t=Pu("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),Au=Lu||Iu((function(){return!Pu("a","y").sticky})),ku={BROKEN_CARET:Lu||Iu((function(){var t=Pu("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:Au,UNSUPPORTED_Y:Lu},Cu=g,_u=r.RegExp,Uu=Cu((function(){var t=_u(".","s");return!(t.dotAll&&t.exec("\n")&&"s"===t.flags)})),Mu=g,Du=r.RegExp,Fu=Mu((function(){var t=Du("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),Nu=$t,Gu=x,$u=ju,zu=function(){var t=Tu(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Bu=ku,Vu=G.exports,Hu=Lr,qu=an.get,Wu=Uu,Yu=Fu,Ku=Vu("native-string-replace",String.prototype.replace),Qu=RegExp.prototype.exec,Xu=Qu,Ju=Gu("".charAt),Zu=Gu("".indexOf),ta=Gu("".replace),ea=Gu("".slice),ra=(du=/b*/g,Nu(Qu,yu=/a/,"a"),Nu(Qu,du,"a"),0!==yu.lastIndex||0!==du.lastIndex),na=Bu.BROKEN_CARET,oa=void 0!==/()??/.exec("")[1];(ra||oa||na||Wu||Yu)&&(Xu=function(t){var e,r,n,o,i,u,a,c=this,f=qu(c),s=$u(t),l=f.raw;if(l)return l.lastIndex=c.lastIndex,e=Nu(Xu,l,s),c.lastIndex=l.lastIndex,e;var p=f.groups,v=na&&c.sticky,h=Nu(zu,c),y=c.source,d=0,g=s;if(v&&(h=ta(h,"y",""),-1===Zu(h,"g")&&(h+="g"),g=ea(s,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==Ju(s,c.lastIndex-1))&&(y="(?: "+y+")",g=" "+g,d++),r=new RegExp("^(?:"+y+")",h)),oa&&(r=new RegExp("^"+y+"$(?!\\s)",h)),ra&&(n=c.lastIndex),o=Nu(Qu,v?r:c,g),v?o?(o.input=ea(o.input,d),o[0]=ea(o[0],d),o.index=c.lastIndex,c.lastIndex+=o[0].length):c.lastIndex=0:ra&&o&&(c.lastIndex=c.global?o.index+o[0].length:n),oa&&o&&o.length>1&&Nu(Ku,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&p)for(o.groups=u=Hu(null),i=0;i<p.length;i++)u[(a=p[i])[0]]=o[a[1]];return o});var ia=Xu;Uo({target:"RegExp",proto:!0,forced:/./.exec!==ia},{exec:ia});var ua=T,aa=x,ca=function(t){if("Function"===ua(t))return aa(t)},fa=ca,sa=to,la=ia,pa=g,va=It,ha=qr,ya=va("species"),da=RegExp.prototype,ga=x,ba=Ue,ma=ju,Sa=M,wa=ga("".charAt),Oa=ga("".charCodeAt),xa=ga("".slice),Ra=function(t){return function(e,r){var n,o,i=ma(Sa(e)),u=ba(r),a=i.length;return u<0||u>=a?t?"":void 0:(n=Oa(i,u))<55296||n>56319||u+1===a||(o=Oa(i,u+1))<56320||o>57343?t?wa(i,u):n:t?xa(i,u,u+2):o-56320+(n-55296<<10)+65536}},Ea={codeAt:Ra(!1),charAt:Ra(!0)}.charAt,ja=x,Ta=J,Ia=Math.floor,Pa=ja("".charAt),La=ja("".replace),Aa=ja("".slice),ka=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ca=/\$([$&'`]|\d{1,2})/g,_a=$t,Ua=kt,Ma=u,Da=T,Fa=ia,Na=TypeError,Ga=vu,$a=$t,za=x,Ba=function(t,e,r,n){var o=va(t),i=!pa((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),u=i&&!pa((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[ya]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!u||r){var a=fa(/./[o]),c=e(o,""[t],(function(t,e,r,n,o){var u=fa(t),c=e.exec;return c===la||c===da.exec?i&&!o?{done:!0,value:a(e,r,n)}:{done:!0,value:u(r,e,n)}:{done:!1}}));sa(String.prototype,t,c[0]),sa(da,o,c[1])}n&&ha(da[o],"sham",!0)},Va=g,Ha=kt,qa=u,Wa=C,Ya=Ue,Ka=ze,Qa=ju,Xa=M,Ja=function(t,e,r){return e+(r?Ea(t,e).length:1)},Za=ue,tc=function(t,e,r,n,o,i){var u=r+t.length,a=n.length,c=Ca;return void 0!==o&&(o=Ta(o),c=ka),La(i,c,(function(i,c){var f;switch(Pa(c,0)){case"$":return"$";case"&":return t;case"`":return Aa(e,0,r);case"'":return Aa(e,u);case"<":f=o[Aa(c,1,-1)];break;default:var s=+c;if(0===s)return i;if(s>a){var l=Ia(s/10);return 0===l?i:l<=a?void 0===n[l-1]?Pa(c,1):n[l-1]+Pa(c,1):i}f=n[s-1]}return void 0===f?"":f}))},ec=function(t,e){var r=t.exec;if(Ma(r)){var n=_a(r,t,e);return null!==n&&Ua(n),n}if("RegExp"===Da(t))return _a(Fa,t,e);throw Na("RegExp#exec called on incompatible receiver")},rc=It("replace"),nc=Math.max,oc=Math.min,ic=za([].concat),uc=za([].push),ac=za("".indexOf),cc=za("".slice),fc="$0"==="a".replace(/./,"$0"),sc=!!/./[rc]&&""===/./[rc]("a","$0");Ba("replace",(function(t,e,r){var n=sc?"$":"$0";return[function(t,r){var n=Xa(this),o=Wa(t)?void 0:Za(t,rc);return o?$a(o,t,n,r):$a(e,Qa(n),t,r)},function(t,o){var i=Ha(this),u=Qa(t);if("string"==typeof o&&-1===ac(o,n)&&-1===ac(o,"$<")){var a=r(e,i,u,o);if(a.done)return a.value}var c=qa(o);c||(o=Qa(o));var f=i.global;if(f){var s=i.unicode;i.lastIndex=0}for(var l=[];;){var p=ec(i,u);if(null===p)break;if(uc(l,p),!f)break;""===Qa(p[0])&&(i.lastIndex=Ja(u,Ka(i.lastIndex),s))}for(var v,h="",y=0,d=0;d<l.length;d++){for(var g=Qa((p=l[d])[0]),b=nc(oc(Ya(p.index),u.length),0),m=[],S=1;S<p.length;S++)uc(m,void 0===(v=p[S])?v:String(v));var w=p.groups;if(c){var O=ic([g],m,b,u);void 0!==w&&uc(O,w);var x=Qa(Ga(o,void 0,O))}else x=tc(g,u,b,m,w,o);b>=y&&(h+=cc(u,y,b)+x,y=b+g.length)}return h+cc(u,y)}]}),!!Va((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!fc||sc);var lc=r.Promise,pc=x,vc=g,hc=u,yc=xu,dc=kn,gc=function(){},bc=[],mc=Ht("Reflect","construct"),Sc=/^\s*(?:class|function)\b/,wc=pc(Sc.exec),Oc=!Sc.exec(gc),xc=function(t){if(!hc(t))return!1;try{return mc(gc,bc,t),!0}catch(t){return!1}},Rc=function(t){if(!hc(t))return!1;switch(yc(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Oc||!!wc(Sc,dc(t))}catch(t){return!0}};Rc.sham=!0;var Ec=!mc||vc((function(){var t;return xc(xc.call)||!xc(Object)||!xc((function(){t=!0}))||t}))?Rc:xc,jc=Ec,Tc=Zt,Ic=TypeError,Pc=kt,Lc=function(t){if(jc(t))return t;throw Ic(Tc(t)+" is not a constructor")},Ac=C,kc=It("species"),Cc={},_c=ne,Uc=TypeError,Mc=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Uc("Bad Promise constructor");e=t,r=n})),this.resolve=_c(e),this.reject=_c(r)};Cc.f=function(t){return new Mc(t)};var Dc=kt,Fc=f,Nc=Cc,Gc=Uo,$c=lc,zc=g,Bc=Ht,Vc=u,Hc=function(t,e){var r,n=Pc(t).constructor;return void 0===n||Ac(r=Pc(n)[kc])?e:Lc(r)},qc=function(t,e){if(Dc(t),Fc(e)&&e.constructor===t)return e;var r=Nc.f(t);return(0,r.resolve)(e),r.promise},Wc=to,Yc=$c&&$c.prototype;if(Gc({target:"Promise",proto:!0,real:!0,forced:!!$c&&zc((function(){Yc.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=Hc(this,Bc("Promise")),r=Vc(t);return this.then(r?function(r){return qc(e,t()).then((function(){return r}))}:t,r?function(r){return qc(e,t()).then((function(){throw r}))}:t)}}),Vc($c)){var Kc=Bc("Promise").prototype.finally;Yc.finally!==Kc&&Wc(Yc,"finally",Kc,{unsafe:!0})}var Qc=g,Xc=_t,Jc=It("iterator"),Zc=!Qc((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,r=new URLSearchParams("a=1&a=2"),n="";return t.pathname="c%20d",e.forEach((function(t,r){e.delete("b"),n+=r+t})),r.delete("a",2),!e.size&&!Xc||!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[Jc]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),tf=On.exports,ef=Mt,rf=to,nf=qt,of=TypeError,uf=ne,af=b,cf=ca(ca.bind),ff=function(t,e){return uf(t),void 0===e?t:af?cf(t,e):function(){return t.apply(e,arguments)}},sf=xu,lf=ue,pf=C,vf=Nr,hf=It("iterator"),yf=function(t){if(!pf(t))return lf(t,hf)||lf(t,"@@iterator")||vf[sf(t)]},df=$t,gf=ne,bf=kt,mf=Zt,Sf=yf,wf=TypeError,Of=function(t,e){var r=arguments.length<2?Sf(t):e;if(gf(r))return bf(df(r,t));throw wf(mf(t)+" is not iterable")},xf=TypeError,Rf=Se,Ef=Mt,jf=Br,Tf=Ne,If=Ve,Pf=function(t,e,r){var n=Rf(e);n in t?Ef.f(t,n,jf(0,r)):t[n]=r},Lf=Array,Af=Math.max,kf=function(t,e,r){for(var n=If(t),o=Tf(e,n),i=Tf(void 0===r?n:r,n),u=Lf(Af(i-o,0)),a=0;o<i;o++,a++)Pf(u,a,t[o]);return u.length=a,u},Cf=Math.floor,_f=function(t,e){var r=t.length,n=Cf(r/2);return r<8?Uf(t,e):Mf(t,_f(kf(t,0,n),e),_f(kf(t,n),e),e)},Uf=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Mf=function(t,e,r,n){for(var o=e.length,i=r.length,u=0,a=0;u<o||a<i;)t[u+a]=u<o&&a<i?n(e[u],r[a])<=0?e[u++]:r[a++]:u<o?e[u++]:r[a++];return t},Df=Uo,Ff=r,Nf=$t,Gf=x,$f=_t,zf=Zc,Bf=to,Vf=function(t,e,r){return r.get&&tf(r.get,e,{getter:!0}),r.set&&tf(r.set,e,{setter:!0}),ef.f(t,e,r)},Hf=function(t,e,r){for(var n in e)rf(t,n,e[n],r);return t},qf=ni,Wf=si,Yf=an,Kf=function(t,e){if(nf(e,t))return t;throw of("Incorrect invocation")},Qf=u,Xf=et,Jf=ff,Zf=xu,ts=kt,es=f,rs=ju,ns=Lr,os=Br,is=Of,us=yf,as=function(t,e){if(t<e)throw xf("Not enough arguments");return t},cs=_f,fs=It("iterator"),ss="URLSearchParams",ls="URLSearchParamsIterator",ps=Yf.set,vs=Yf.getterFor(ss),hs=Yf.getterFor(ls),ys=Object.getOwnPropertyDescriptor,ds=function(t){if(!$f)return Ff[t];var e=ys(Ff,t);return e&&e.value},gs=ds("fetch"),bs=ds("Request"),ms=ds("Headers"),Ss=bs&&bs.prototype,ws=ms&&ms.prototype,Os=Ff.RegExp,xs=Ff.TypeError,Rs=Ff.decodeURIComponent,Es=Ff.encodeURIComponent,js=Gf("".charAt),Ts=Gf([].join),Is=Gf([].push),Ps=Gf("".replace),Ls=Gf([].shift),As=Gf([].splice),ks=Gf("".split),Cs=Gf("".slice),_s=/\+/g,Us=Array(4),Ms=function(t){return Us[t-1]||(Us[t-1]=Os("((?:%[\\da-f]{2}){"+t+"})","gi"))},Ds=function(t){try{return Rs(t)}catch(e){return t}},Fs=function(t){var e=Ps(t,_s," "),r=4;try{return Rs(e)}catch(t){for(;r;)e=Ps(e,Ms(r--),Ds);return e}},Ns=/[!'()~]|%20/g,Gs={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},$s=function(t){return Gs[t]},zs=function(t){return Ps(Es(t),Ns,$s)},Bs=Wf((function(t,e){ps(this,{type:ls,iterator:is(vs(t).entries),kind:e})}),"Iterator",(function(){var t=hs(this),e=t.kind,r=t.iterator.next(),n=r.value;return r.done||(r.value="keys"===e?n.key:"values"===e?n.value:[n.key,n.value]),r}),!0),Vs=function(t){this.entries=[],this.url=null,void 0!==t&&(es(t)?this.parseObject(t):this.parseQuery("string"==typeof t?"?"===js(t,0)?Cs(t,1):t:rs(t)))};Vs.prototype={type:ss,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,r,n,o,i,u,a,c=us(t);if(c)for(r=(e=is(t,c)).next;!(n=Nf(r,e)).done;){if(i=(o=is(ts(n.value))).next,(u=Nf(i,o)).done||(a=Nf(i,o)).done||!Nf(i,o).done)throw xs("Expected sequence with length 2");Is(this.entries,{key:rs(u.value),value:rs(a.value)})}else for(var f in t)Xf(t,f)&&Is(this.entries,{key:f,value:rs(t[f])})},parseQuery:function(t){if(t)for(var e,r,n=ks(t,"&"),o=0;o<n.length;)(e=n[o++]).length&&(r=ks(e,"="),Is(this.entries,{key:Fs(Ls(r)),value:Fs(Ts(r,"="))}))},serialize:function(){for(var t,e=this.entries,r=[],n=0;n<e.length;)t=e[n++],Is(r,zs(t.key)+"="+zs(t.value));return Ts(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Hs=function(){Kf(this,qs);var t=arguments.length>0?arguments[0]:void 0,e=ps(this,new Vs(t));$f||(this.size=e.entries.length)},qs=Hs.prototype;if(Hf(qs,{append:function(t,e){var r=vs(this);as(arguments.length,2),Is(r.entries,{key:rs(t),value:rs(e)}),$f||this.length++,r.updateURL()},delete:function(t){for(var e=vs(this),r=as(arguments.length,1),n=e.entries,o=rs(t),i=r<2?void 0:arguments[1],u=void 0===i?i:rs(i),a=0;a<n.length;){var c=n[a];if(c.key!==o||void 0!==u&&c.value!==u)a++;else if(As(n,a,1),void 0!==u)break}$f||(this.size=n.length),e.updateURL()},get:function(t){var e=vs(this).entries;as(arguments.length,1);for(var r=rs(t),n=0;n<e.length;n++)if(e[n].key===r)return e[n].value;return null},getAll:function(t){var e=vs(this).entries;as(arguments.length,1);for(var r=rs(t),n=[],o=0;o<e.length;o++)e[o].key===r&&Is(n,e[o].value);return n},has:function(t){for(var e=vs(this).entries,r=as(arguments.length,1),n=rs(t),o=r<2?void 0:arguments[1],i=void 0===o?o:rs(o),u=0;u<e.length;){var a=e[u++];if(a.key===n&&(void 0===i||a.value===i))return!0}return!1},set:function(t,e){var r=vs(this);as(arguments.length,1);for(var n,o=r.entries,i=!1,u=rs(t),a=rs(e),c=0;c<o.length;c++)(n=o[c]).key===u&&(i?As(o,c--,1):(i=!0,n.value=a));i||Is(o,{key:u,value:a}),$f||(this.size=o.length),r.updateURL()},sort:function(){var t=vs(this);cs(t.entries,(function(t,e){return t.key>e.key?1:-1})),t.updateURL()},forEach:function(t){for(var e,r=vs(this).entries,n=Jf(t,arguments.length>1?arguments[1]:void 0),o=0;o<r.length;)n((e=r[o++]).value,e.key,this)},keys:function(){return new Bs(this,"keys")},values:function(){return new Bs(this,"values")},entries:function(){return new Bs(this,"entries")}},{enumerable:!0}),Bf(qs,fs,qs.entries,{name:"entries"}),Bf(qs,"toString",(function(){return vs(this).serialize()}),{enumerable:!0}),$f&&Vf(qs,"size",{get:function(){return vs(this).entries.length},configurable:!0,enumerable:!0}),qf(Hs,ss),Df({global:!0,constructor:!0,forced:!zf},{URLSearchParams:Hs}),!zf&&Qf(ms)){var Ws=Gf(ws.has),Ys=Gf(ws.set),Ks=function(t){if(es(t)){var e,r=t.body;if(Zf(r)===ss)return e=t.headers?new ms(t.headers):new ms,Ws(e,"content-type")||Ys(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ns(t,{body:os(0,rs(r)),headers:os(0,e)})}return t};if(Qf(gs)&&Df({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return gs(t,arguments.length>1?Ks(arguments[1]):{})}}),Qf(bs)){var Qs=function(t){return Kf(this,Ss),new bs(t,arguments.length>1?Ks(arguments[1]):{})};Ss.constructor=Qs,Qs.prototype=Ss,Df({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Qs})}}var Xs=Nr,Js=It("iterator"),Zs=Array.prototype,tl=$t,el=kt,rl=ue,nl=ff,ol=$t,il=kt,ul=Zt,al=function(t){return void 0!==t&&(Xs.Array===t||Zs[Js]===t)},cl=Ve,fl=qt,sl=Of,ll=yf,pl=function(t,e,r){var n,o;el(t);try{if(!(n=rl(t,"return"))){if("throw"===e)throw r;return r}n=tl(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return el(n),r},vl=TypeError,hl=function(t,e){this.stopped=t,this.result=e},yl=hl.prototype,dl=It("iterator"),gl=!1;try{var bl=0,ml={next:function(){return{done:!!bl++}},return:function(){gl=!0}};ml[dl]=function(){return this},Array.from(ml,(function(){throw 2}))}catch(t){}var Sl="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,wl="undefined"!=typeof process&&"process"==T(process),Ol=!Sl&&!wl&&"object"==typeof window&&"object"==typeof document,xl=r,Rl=lc,El=u,jl=To,Tl=kn,Il=It,Pl=Ol,Ll=Sl,Al=vt;Rl&&Rl.prototype;var kl=Il("species"),Cl=!1,_l=El(xl.PromiseRejectionEvent),Ul=jl("Promise",(function(){var t=Tl(Rl),e=t!==String(Rl);if(!e&&66===Al)return!0;if(!Al||Al<51||!/native code/.test(t)){var r=new Rl((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[kl]=n,!(Cl=r.then((function(){}))instanceof n))return!0}return!e&&(Pl||Ll)&&!_l})),Ml=lc,Dl=function(t,e){if(!e&&!gl)return!1;var r=!1;try{var n={};n[dl]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Fl={CONSTRUCTOR:Ul,REJECTION_EVENT:_l,SUBCLASSING:Cl}.CONSTRUCTOR||!Dl((function(t){Ml.all(t).then(void 0,(function(){}))})),Nl=$t,Gl=ne,$l=Cc,zl=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Bl=function(t,e,r){var n,o,i,u,a,c,f,s=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),v=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),y=nl(e,s),d=function(t){return n&&pl(n,"normal",t),new hl(!0,t)},g=function(t){return l?(il(t),h?y(t[0],t[1],d):y(t[0],t[1])):h?y(t,d):y(t)};if(p)n=t.iterator;else if(v)n=t;else{if(!(o=ll(t)))throw vl(ul(t)+" is not iterable");if(al(o)){for(i=0,u=cl(t);u>i;i++)if((a=g(t[i]))&&fl(yl,a))return a;return new hl(!1)}n=sl(t,o)}for(c=p?t.next:n.next;!(f=ol(c,n)).done;){try{a=g(f.value)}catch(t){pl(n,"throw",t)}if("object"==typeof a&&a&&fl(yl,a))return a}return new hl(!1)};Uo({target:"Promise",stat:!0,forced:Fl},{allSettled:function(t){var e=this,r=$l.f(e),n=r.resolve,o=r.reject,i=zl((function(){var r=Gl(e.resolve),o=[],i=0,u=1;Bl(t,(function(t){var a=i++,c=!1;u++,Nl(r,e,t).then((function(t){c||(c=!0,o[a]={status:"fulfilled",value:t},--u||n(o))}),(function(t){c||(c=!0,o[a]={status:"rejected",reason:t},--u||n(o))}))})),--u||n(o)}));return i.error&&o(i.value),r.promise}})}();
var FRVRSDK=function(e){"use strict";function t(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(r[s[i]]=e[s[i]])}return r}function r(e,t,r,s){return new(r||(r=Promise))((function(i,o){function n(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,a)}d((s=s.apply(e,t||[])).next())}))}var s;e.Env=void 0,(s=e.Env||(e.Env={})).DEVELOPMENT="dev",s.BETA="beta",s.PRODUCTION="prod";const i={log:()=>{},error:()=>{},warn:()=>{},info:()=>{},debug:()=>{}};class o{constructor({provider:e,logger:t}){this.provider=e,this.logger=t||i}setItems(e){const t=e.map((({key:e,value:t})=>({key:e,value:JSON.stringify(t)})));return this.provider.setItems(t)}getItems(e){return r(this,void 0,void 0,(function*(){const t=yield this.provider.getItems(e),r={};for(const e in t)try{r[e]=JSON.parse(t[e])}catch(s){r[e]=t[e],this.logger.error(`[storage] parsing error on key ${e}`,s.message)}return r}))}removeItems(e){return this.provider.removeItems(e)}setItem(e,t){return this.provider.setItems([{key:e,value:JSON.stringify(t)}])}getItem(e,t){return r(this,void 0,void 0,(function*(){let r;const s=(yield this.provider.getItems([e]))[e];try{r=void 0!==s?JSON.parse(s):t}catch(i){r=null!=t?t:s,this.logger.error(`[storage] parsing error on key ${e}`,i.message)}return r}))}removeItem(e){return r(this,void 0,void 0,(function*(){return this.provider.removeItems([e])}))}isPersistent(){return this.provider.isPersistent()}}const n="test-01e0e1c8-2a13-4fe9-b8d0-458a98c4fc89";class a{static isSupported(){try{return window.localStorage.setItem(n,"test"),window.localStorage.removeItem(n),!0}catch(e){return!1}}setItems(e){return r(this,void 0,void 0,(function*(){for(const t of e)window.localStorage.setItem(t.key,t.value)}))}getItems(e){return r(this,void 0,void 0,(function*(){const t={};for(const r of e){const e=window.localStorage.getItem(r);null!==e&&(t[r]=e)}return t}))}removeItems(e){return r(this,void 0,void 0,(function*(){for(const t of e)window.localStorage.removeItem(t)}))}isPersistent(){return!0}}a.providerName="web";class d{constructor(){this.values={}}setItems(e){return r(this,void 0,void 0,(function*(){for(const t of e)this.values[t.key]=t.value}))}getItems(e){return r(this,void 0,void 0,(function*(){const t={};for(const r of e){const e=this.values[r];void 0!==e&&(t[r]=e)}return t}))}removeItems(e){return r(this,void 0,void 0,(function*(){for(const t of e)delete this.values[t]}))}isPersistent(){return!1}}d.providerName="memory";const c=new o({provider:new d}),h=e=>{for(const t of e)switch(t){case a.providerName:if(a.isSupported())return new a;break;case d.providerName:return new d;default:throw new Error("Unsupported Local Storage provider")}throw new Error("Error initializing Local Storage provider")},l={init:()=>Promise.resolve(),setProgress:()=>{},complete:()=>Promise.resolve()};function u(){this.code="INVALID_OPERATION",this.message="Trying to use an empty interface."}const g={init:()=>r(void 0,void 0,void 0,(function*(){})),canCreateShortcut:()=>Promise.resolve(!1),createShortcut:()=>Promise.reject(new u)};function v(){this.code="INVALID_OPERATION",this.message="Trying to use an empty interface."}const p={needsConfiguration:()=>!1,canMoveToMobile:()=>Promise.resolve(!1),moveToMobile:()=>Promise.reject(new v)};var f;e.ConsentOptions=void 0,(f=e.ConsentOptions||(e.ConsentOptions={}))[f.None=0]="None",f[f.P1StoreInformationOnADevice=2]="P1StoreInformationOnADevice",f[f.P2SelectBasicAds=4]="P2SelectBasicAds",f[f.P3PersonalizedAdsProfile=8]="P3PersonalizedAdsProfile",f[f.P4PersonalizedAds=16]="P4PersonalizedAds",f[f.P5PersonalizedContentProfile=32]="P5PersonalizedContentProfile",f[f.P6PersonalizedContent=64]="P6PersonalizedContent",f[f.P7MeasureAdPerformance=128]="P7MeasureAdPerformance",f[f.P8MeasureContentPerformance=256]="P8MeasureContentPerformance",f[f.P9MarketResearchForAudienceInsights=512]="P9MarketResearchForAudienceInsights",f[f.P10DevelopAndImproveProducts=1024]="P10DevelopAndImproveProducts",f[f.All=2046]="All";const m={consentToTerms:()=>{},onConsentChanged(e){},hasConsentForAll:(e,t)=>!1,hasConsentForAny:(e,t)=>!1,consents:()=>e.ConsentOptions.None,legitimateInterests:()=>e.ConsentOptions.None,hasLoaded:()=>!0},I={consentToTerms:()=>{},onConsentChanged(e){},hasConsentForAll:(e,t)=>!0,hasConsentForAny:(e,t)=>!0,consents:()=>e.ConsentOptions.All,legitimateInterests:()=>e.ConsentOptions.All,hasLoaded:()=>!0},y={id:()=>"",name:()=>"",nickname:()=>"",image:()=>"",loadImage:()=>Promise.reject(new Error("EMPTY_PROFILE"))},P={allowExternalLinks:!0,allowInternalLinks:!0,allowNavigation:!0,allowSendBeacon:!0,allowThirdPartyDomains:!0,hasDedicatedLoadingScreen:!0},S={getData:()=>Promise.reject(new Error("EMPTY_ENTRYPOINT_DATA")),getName:()=>Promise.reject(new Error("EMPTY_ENTRYPOINT_NAME"))},E={canFollowOfficialPage:()=>Promise.resolve(!1),followOfficialPage:()=>Promise.reject(new Error("EMPTY_FOLLOW_OFFICIAL_PAGE")),canJoinOfficialGroup:()=>Promise.resolve(!1),joinOfficialGroup:()=>Promise.reject(new Error("EMPTY_FOLLOW_OFFICIAL_GROUP"))};const b={canNavigate:()=>!1,navigate:()=>{throw new Error("EMPTY_NAVIGATE_IMPLEMENTATION")},canOpenChannelAppStore:()=>!1,openChannelAppStore:()=>{throw new Error("EMPTY_OPEN_CHANNEL_STORE_IMPLEMENTATION")}};var _;e.AdType=void 0,(_=e.AdType||(e.AdType={})).INTERSTITIAL="interstitial",_.REWARD="reward",_.BANNER="banner",_.SURVEY="survey",_.REWARDED_INTERSTITIAL="rewarded-interstitial";const T={[e.AdType.INTERSTITIAL]:{stopsGameFlow:!0,throttleable:!0},[e.AdType.REWARD]:{stopsGameFlow:!0,throttleable:!1},[e.AdType.BANNER]:{stopsGameFlow:!1,throttleable:!1},[e.AdType.SURVEY]:{stopsGameFlow:!0,throttleable:!0},[e.AdType.REWARDED_INTERSTITIAL]:{stopsGameFlow:!0,throttleable:!0}},R={onSuspend:()=>{},onResume:()=>{},onAudioSuspend:()=>{},onAudioResume:()=>{}},C={logEvent:()=>{}};var A,w;e.AdResponseStatus=void 0,(A=e.AdResponseStatus||(e.AdResponseStatus={})).AD_CLOSED="adclosed",A.AD_LEAVING_APPLICATION="adleavingapplication",A.CANCELED="canceled",A.ERROR="error",A.INTERNAL_ERROR="internalerror",A.INVALID_REQUEST="invalidrequest",A.NETWORK_ERROR="networkerror",A.NOFILL="nofill",A.SUCCESS="success",A.THROTTLED="throttled",A.TIMEOUT="timeout",e.AdFinishedStatus=void 0,(w=e.AdFinishedStatus||(e.AdFinishedStatus={})).ERROR="error",w.NOFILL="nofill",w.SKIPPED="skipped",w.SUCCESS="success",w.TIMEDOUT="timedout";const O={[e.AdType.INTERSTITIAL]:"mandatory",[e.AdType.REWARD]:"rewarded"};class k{constructor(e,t){this.tracker=e,this.params=t}getEventName(e){var t;return`ad_${null!==(t=O[this.params.adType])&&void 0!==t?t:this.params.adType}_${e}`}logEvent(t,r){this.tracker.logEvent(t,r,e.ConsentOptions.None)}requestingAd(e,t){const r=this.getEventName("request");this.logEvent(r,Object.assign(Object.assign({},t),{provider:this.params.provider,advertisement_id:e}))}receivedAdResponse(e,t,r){const s=this.getEventName("response");this.logEvent(s,Object.assign(Object.assign({},r),{provider:this.params.provider,advertisement_id:t,ad_response:e}))}willShowAd(e,t,r){const s=this.getEventName("show");this.logEvent(s,Object.assign(Object.assign({},r),{provider:this.params.provider,advertisement_id:t,preloaded:e}))}finishedAd(e,t,r){const s=this.getEventName("finish");this.logEvent(s,Object.assign(Object.assign({},r),{provider:this.params.provider,advertisement_id:t,ad_result:e}))}}var N,F,L,D,U;e.AdSuccess=void 0,(N=e.AdSuccess||(e.AdSuccess={})).DELIVERED="delivered",N.COMPLETED="completed",e.AdError=void 0,(F=e.AdError||(e.AdError={})).ON_LOAD="on_load",F.ON_SHOW="on_show",F.BLOCKED="blocked",F.NOFILL="nofill",F.TIMED_OUT="timed_out";class V{constructor(e){this.type=e}getName(){return"dev"}getType(){return this.type}isReady(){return!0}useManualControl(){return!1}init(e,t,r){return this.tracker=r,new Promise((e=>{setTimeout((()=>{console.log(`[dev] ${this.type} ad initialised`),e()}),100)}))}show(){var t,r,s,i,o;null===(t=this.tracker)||void 0===t||t.requestingAd(),null===(r=this.tracker)||void 0===r||r.receivedAdResponse(e.AdResponseStatus.SUCCESS),null===(s=this.tracker)||void 0===s||s.willShowAd(!1),console.log(`[dev] ${this.type} ad displayed`);const n=confirm("Want to check out this ad?");n?(console.log(`[dev] ${this.type} ad checked`),null===(i=this.tracker)||void 0===i||i.finishedAd(e.AdFinishedStatus.SUCCESS)):(console.log(`[dev] ${this.type} ad skipped/dismissed`),null===(o=this.tracker)||void 0===o||o.finishedAd(e.AdFinishedStatus.SKIPPED));const a={success:!0,code:n?e.AdSuccess.COMPLETED:e.AdSuccess.DELIVERED};return Promise.resolve(a)}}class j extends V{constructor(){super(e.AdType.INTERSTITIAL)}}class x extends V{constructor(){super(e.AdType.REWARD)}}e.AdsThrottlerResult=void 0,(L=e.AdsThrottlerResult||(e.AdsThrottlerResult={}))[L.NO_THROTTLING=0]="NO_THROTTLING",L.INIT_TIME="INIT_TIME",L.FREQUENCY="FREQUENCY";class M{constructor(){this.maxfrequency=0,this.initTimeBlock=0,this.forceFirstAd=!1,this.MAX_FREQUENCY_DEFAULT=3e5,this.FIRST_SESSION_AD_SPEED_RATE=3}getFirstIntervalTime(e){const t=e.isFirstAdEver?this.maxfrequency:this.maxfrequency/this.FIRST_SESSION_AD_SPEED_RATE;return e.initTime-t}getInitialisedState(e){return e.lastShownAd?e:Object.assign(Object.assign({},e),{lastShownAd:this.getFirstIntervalTime(e)})}shouldBlockByInitTime(e,t){return t-e.initTime<this.initTimeBlock}shouldBlockByFrequency(e,t){const r=t-e.lastShownAd;return this.maxfrequency>0&&r<this.maxfrequency&&!(e.isFirstAd&&this.forceFirstAd)}init(e){this.initTimeBlock=e.initTimeBlock||0,this.maxfrequency=void 0===e.maxfrequency?this.MAX_FREQUENCY_DEFAULT:e.maxfrequency,this.forceFirstAd=e.forceFirstAd||!1}mustThrottle(t,r){r=void 0===r?(new Date).getTime():r;const s=this.getInitialisedState(t);return this.shouldBlockByInitTime(s,r)?e.AdsThrottlerResult.INIT_TIME:this.shouldBlockByFrequency(s,r)?e.AdsThrottlerResult.FREQUENCY:e.AdsThrottlerResult.NO_THROTTLING}checkpoint(e,t){return t=void 0===t?(new Date).getTime():t,Object.assign(Object.assign({},e),{isFirstAd:!1,isFirstAdEver:!1,lastShownAd:t})}}e.AdShowResult=void 0,(D=e.AdShowResult||(e.AdShowResult={})).NOT_DISPLAYED="not_displayed",D.DELIVERED="delivered",D.COMPLETED="completed";class B{constructor({logger:t=i,throttler:r,storage:s=c,tracker:o=C,controls:n=R,onBeforeInit:a=(()=>Promise.resolve())}={}){this.config={},this.registeredProviders={},this.providers=[],this.ADSTORAGE_FIRST_TIME_KEY="__ads_firstTimeView",this.AdType=e.AdType,this.AdShowResult=e.AdShowResult,this.logger=t,this.throttler=r||new M,this.storage=s,this.tracker=o,this.controls=n,this.onBeforeInit=a,this.throttlerState={initTime:(new Date).getTime(),isFirstAd:!0,isFirstAdEver:!1,lastShownAd:0}}register(e){const t=`${e.getName()}#${e.getType()}`;this.registeredProviders[t]=e}configure(e){this.config=e}init(){var e;return r(this,void 0,void 0,(function*(){yield null===(e=this.onBeforeInit)||void 0===e?void 0:e.call(this),this.throttlerState.isFirstAdEver=(yield this.storage.getItem(this.ADSTORAGE_FIRST_TIME_KEY,!0))||!1,this.logger.log("[ads] first time ever?",this.throttlerState.isFirstAdEver),this.throttler.init(this.config.throttling||{});const t=[...this.config.providers||[]];t.sort(((e,t)=>e.priority-t.priority));const r=t.map((e=>{const t=`${e.name}#${e.type}`;return{provider:this.registeredProviders[t],providerConfig:e,key:t}})).filter((({provider:e})=>e)).map((({provider:e,providerConfig:t,key:r})=>{const s=new k(this.tracker,{adType:e.getType(),provider:e.getName()});return e.init(t,this.controls,s).then((()=>e)).catch((e=>{this.logger.warn(`[ads] Ad provider ${r} could not be initialised`,e)}))})),s=(yield Promise.all(r)).filter((e=>void 0!==e));this.providers=s}))}getProviders(){return this.providers}getProvidersByType(e){return this.providers.filter((t=>t.getType()===e))}isSupported(e){return this.getProvidersByType(e).length>0}isReady(e){return void 0!==this.getProvidersByType(e).find((e=>e.isReady()))}show(t){return r(this,void 0,void 0,(function*(){const s=T[t].throttleable;if(s){const t=this.throttler.mustThrottle(this.throttlerState);if(t)return this.logger.log("[ads] Ad was throttled, reason =",t),Promise.resolve(e.AdShowResult.NOT_DISPLAYED)}const i=this.getProvidersByType(t);let o=!1;const n=yield function(e,t){const r=s=>{const i=e[s];return i?t(i).then((e=>void 0===e?r(s+1):e)):Promise.resolve(void 0)};return r(0)}(i,(e=>r(this,void 0,void 0,(function*(){try{if(!e.isReady())return void this.logger.warn("[ads] provider",e.getName(),"not ready");T[t].stopsGameFlow&&!e.useManualControl()&&(this.controls.onSuspend(),this.controls.onAudioSuspend(),o=!0);const r=yield e.show();return!1===r.success&&this.logger.error("[ads] show error",r.message),r.success?r.code:void 0}catch(e){this.logger.error("[ads] show error",e)}}))));return T[t].stopsGameFlow&&o&&(this.controls.onAudioResume(),this.controls.onResume()),void 0!==n?(s&&(this.throttlerState=this.throttler.checkpoint(this.throttlerState),yield this.storage.setItem(this.ADSTORAGE_FIRST_TIME_KEY,!1)),n===e.AdSuccess.COMPLETED?e.AdShowResult.COMPLETED:e.AdShowResult.DELIVERED):e.AdShowResult.NOT_DISPLAYED}))}hide(e){return r(this,void 0,void 0,(function*(){const t=this.getProvidersByType(e);for(const e of t)try{yield e.hide()}catch(e){this.logger.error("[ads] hide error",e)}}))}setUserConsent(e){this.providers.forEach((t=>{var r;return null===(r=t.setUserConsent)||void 0===r?void 0:r.call(t,e)}))}}class G{constructor(e,t){this.auth=t,this.baseUrl=e.replace(/\/$/,"")}getFriends(e){var t;return r(this,void 0,void 0,(function*(){const r=yield null===(t=this.auth)||void 0===t?void 0:t.authenticatedFetch(`${this.baseUrl}/friends/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!(null==r?void 0:r.ok))throw new $(r);return yield r.json()}))}addFriend(e,t){var s;return r(this,void 0,void 0,(function*(){const r=yield null===(s=this.auth)||void 0===s?void 0:s.authenticatedFetch(`${this.baseUrl}/friends/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!(null==r?void 0:r.ok))throw new $(r);return yield r.json()}))}removeFriend(e,t){var s;return r(this,void 0,void 0,(function*(){const r=yield null===(s=this.auth)||void 0===s?void 0:s.authenticatedFetch(`${this.baseUrl}/friends/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!(null==r?void 0:r.ok))throw new $(r)}))}syncFriends(e,t){var s;return r(this,void 0,void 0,(function*(){const r=yield null===(s=this.auth)||void 0===s?void 0:s.authenticatedFetch(`${this.baseUrl}/friends/${e}/sync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!(null==r?void 0:r.ok))throw new $(r);return yield r.json()}))}}class $ extends Error{constructor(e){super(e.statusText),this.response=e,this.response=e,this.name="ResponseError"}}!function(e){e[e.shareMessage=0]="shareMessage",e[e.sendUpdate=1]="sendUpdate",e[e.invite=2]="invite",e[e.getFriends=3]="getFriends",e[e.getContextId=4]="getContextId",e[e.getContextData=5]="getContextData",e[e.getContextPlayers=6]="getContextPlayers"}(U||(U={}));class H{constructor({provider:e}){this.API=U,this.provider=e}shareMessage(e){return this.provider.shareMessage(e)}sendUpdate(e){return this.provider.sendUpdate(e)}canInvite(){return this.provider.canInvite()}invite(e){return this.provider.invite(e)}getFriends(){return this.provider.getFriends()}getContextData(){return this.provider.getContextData()}getContextId(){return this.provider.getContextId()}getContextPlayers(){return this.provider.getContextPlayers()}getSupportedAPIs(){return this.provider.getSupportedAPIs()}isSupportedAPI(e){return-1!==this.provider.getSupportedAPIs().indexOf(e)}}const W={shareMessage(){return r(this,void 0,void 0,(function*(){}))},sendUpdate(){return r(this,void 0,void 0,(function*(){}))},canInvite(){return r(this,void 0,void 0,(function*(){return!1}))},invite(){return r(this,void 0,void 0,(function*(){}))},getContextId(){return r(this,void 0,void 0,(function*(){return Promise.resolve("")}))},getContextData(){return r(this,void 0,void 0,(function*(){return Promise.resolve({})}))},getContextPlayers(){return r(this,void 0,void 0,(function*(){return Promise.resolve([])}))},getFriends(){return r(this,void 0,void 0,(function*(){return Promise.resolve([])}))},getSupportedAPIs:()=>[]};var K,q,Y;!function(e){e.UPDATE_STATUS="UPDATE_STATUS",e.SEND_GAME_INVITE="SEND_GAME_INVITE"}(K||(K={})),function(e){e.onFriendStatusUpdated="FRIEND_STATUS_UPDATED",e.onConnect="ON_CONNECT",e.onGameInvite="RECEIVE_GAME_INVITE",e.onError="ON_ERROR"}(q||(q={})),function(e){e.open="open",e.close="close",e.error="error",e.message="message",e.retry="retry"}(Y||(Y={}));class z{constructor(e){var t;this.retries=0,this.eventListeners={open:[],close:[],error:[],message:[],retry:[]},this.closedByUser=!1,this.RECONNECT_DEFAULT_BACKOFF_MS=1e3,this.RECONNECT_RETRY_MS=500,this.onOpen=e=>this.handleEvent(Y.open,e),this.onClose=e=>this.handleEvent(Y.close,e),this.onError=e=>this.handleEvent(Y.error,e),this.onMessage=e=>this.handleEvent(Y.message,e),this.url=e.url,this.logger=e.logger,this.webSocketBuilder=null!==(t=e.webSocketBuilder)&&void 0!==t?t:e=>new WebSocket(e)}send(e){this.websocket?this.getConnectionStatus()===WebSocket.OPEN?this.closedByUser?this.logger.error("WebsocketClient: Cannot send message, closed by user"):this.websocket.send(e):this.logger.error("WebsocketClient: Cannot send message, not connected"):this.logger.error("WebsocketClient: Cannot send message, not initialised")}connect(){return r(this,void 0,void 0,(function*(){this.closedByUser=!1,void 0!==this.websocket&&(this.websocket.removeEventListener(Y.open,this.onOpen),this.websocket.removeEventListener(Y.close,this.onClose),this.websocket.removeEventListener(Y.error,this.onError),this.websocket.removeEventListener(Y.message,this.onMessage),this.websocket.close()),this.websocket=this.webSocketBuilder(yield this.url()),this.websocket.addEventListener(Y.open,this.onOpen),this.websocket.addEventListener(Y.close,this.onClose),this.websocket.addEventListener(Y.error,this.onError),this.websocket.addEventListener(Y.message,this.onMessage)}))}close(e,t){var r;this.closedByUser=!0,null===(r=this.websocket)||void 0===r||r.close(e,t)}addEventListener(e,t){const r={listener:t};this.eventListeners[e].push(r)}removeEventListener(e,t){this.eventListeners[e]=this.eventListeners[e].filter((e=>e.listener!==t))}getConnectionStatus(){return this.websocket?this.websocket.readyState:WebSocket.CLOSED}handleEvent(e,t){switch(e){case Y.close:this.closedByUser||this.reconnect();break;case Y.open:this.retries=0;case Y.error:case Y.message:}this.dispatchEvent(e,t)}reconnect(){const e=this.RECONNECT_RETRY_MS*this.retries+this.RECONNECT_DEFAULT_BACKOFF_MS,t={detail:{retries:this.retries++,backoff:e}};setTimeout((()=>{if(this.closedByUser)return;const e=new CustomEvent(Y.retry,t);this.dispatchEvent(Y.retry,e),this.connect()}),e)}dispatchEvent(e,t){this.eventListeners[e].forEach((e=>{e.listener(t)}))}}class J{constructor(e,t){this.friendsStatus=new Map,this.eventListeners={[q.onFriendStatusUpdated]:[],[q.onConnect]:[],[q.onGameInvite]:[],[q.onError]:[]},this.SocialEvents=q;const{apiHost:r,gameId:s}=e;if(this.apiHost=r,this.gameId=s,this.logger=t.logger,this.auth=t.auth,this.websocket=t.webSocketClientBuilder?t.webSocketClientBuilder():new z({logger:this.logger,url:()=>this.getFreshUrl(this.apiHost,this.gameId)}),!this.websocket)throw new Error("websocket client is not defined");this.on(q.onConnect,(({data:e})=>{const t=e.friends;for(const e of t)this.friendsStatus.set(e.userId,e)})),this.on(q.onFriendStatusUpdated,(({data:e})=>{this.friendsStatus.set(e.userId,e)})),this.websocket.addEventListener(Y.open,(()=>{this.logger.log("connected to social server")})),this.websocket.addEventListener(Y.close,(e=>{this.logger.log("websocket client closed",e)})),this.websocket.addEventListener(Y.error,(e=>{this.logger.error("websocket client error",e)})),this.websocket.addEventListener(Y.message,(e=>{const{data:t}=e,r=JSON.parse(t);Object.values(q).includes(r.code)?this.dispatchEvent(r.code,r):this.logger.error("event type is not supported")})),this.auth.addStatusChangeListener((e=>this.onAuthStatusChanged(e)))}connect(){const e=this.connectedUser===this.auth.getFRVRID(),t=this.websocket.getConnectionStatus();(t!==WebSocket.OPEN&&t!==WebSocket.CONNECTING||!e)&&(this.connectedUser=this.auth.getFRVRID(),this.websocket.connect())}close(){this.friendsStatus.clear(),this.connectedUser=void 0,this.websocket.close()}on(e,t){const r={listener:t},s=this.eventListeners[e];if(!s)throw new Error(`event type "${e}" is not supported`);s.push(r)}getFriendsStatus(){return Array.from(this.friendsStatus.values())}sendGameInvite(e,t,r){const s={code:K.SEND_GAME_INVITE,data:{recipientId:e,lobbyId:t,gameId:this.gameId,metadata:r}};this.send(s)}updateStatus(e){const t={code:K.UPDATE_STATUS,data:{metadata:e,gameId:this.gameId}};this.send(t)}dispatchEvent(e,t){this.eventListeners[e].forEach((e=>{e.listener(t)}))}send(e){this.websocket.send(JSON.stringify(e))}onAuthStatusChanged(e){return r(this,void 0,void 0,(function*(){if(e){const e=this.websocket.getConnectionStatus();e!==WebSocket.OPEN&&e!==WebSocket.CONNECTING||this.connect()}else this.close()}))}getFreshUrl(e,t){return r(this,void 0,void 0,(function*(){const r=yield this.auth.getFreshAccessToken();return`wss://${e}/ws?token=${r}&gameId=${t}`}))}}class Q{constructor(t,r){var s,i,o;this.config=t,this.container=r,this.syncedFriendsbyFRVRIDCache={},this.syncedFriendsbyChannelIDCache={},this.providerFriendsCache={},this.API=U,this.auth=r.auth,this.provider=null!==(s=r.provider)&&void 0!==s?s:W,this.gameId=t.gameId;let n=null!==(i=t.apiHostOverride)&&void 0!==i?i:t.env===e.Env.PRODUCTION?"crucible.frvr.com":"staging.crucible.frvr.com";n+="/v1/social",this.webClient=new G(`https://${n}`,this.auth),this.wsClient=new J(Object.assign(Object.assign({},this.config),{apiHost:n}),this.container),this.socialPlatform=new H({provider:this.provider}),(null===(o=t.syncFriendsOnLogin)||void 0===o||o)&&this.auth.addStatusChangeListener(this.onAuthStatusChange.bind(this))}get live(){return this.wsClient}get platform(){return this.socialPlatform}syncFriends(){return r(this,void 0,void 0,(function*(){const e=yield this.provider.getFriends(),t=e.reduce(((e,t)=>{var r;const s=null!==(r=e.get(t.channel))&&void 0!==r?r:[];return s.push(t.id),e.set(t.channel,s),e}),new Map),r=[],s=Array.from(t.entries());for(const[e,t]of s){const s=yield this.webClient.syncFriends(this.getUserId(),{channel:e,gameId:this.gameId,friendIds:t});r.push(...s)}return this.syncedFriendsbyFRVRIDCache=r.reduce(((e,t)=>(e[t.userId]=t,e)),{}),this.syncedFriendsbyChannelIDCache=r.reduce(((e,t)=>(e[t.channelUserId]=t,e)),{}),this.providerFriendsCache=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),r}))}getAllFriends(){return r(this,void 0,void 0,(function*(){return yield this.webClient.getFriends(this.getUserId())}))}getFriendByFRVRID(e){return r(this,void 0,void 0,(function*(){const t=this.syncedFriendsbyFRVRIDCache[e];if(!t)return;const r=this.providerFriendsCache[t.channelUserId];return Object.assign(Object.assign({},t),{name:null==r?void 0:r.name,image:null==r?void 0:r.image})}))}getFriendByChannelId(e){return r(this,void 0,void 0,(function*(){const t=this.syncedFriendsbyChannelIDCache[e];if(!t)return;const r=this.providerFriendsCache[e];return Object.assign(Object.assign({},t),{name:null==r?void 0:r.name,image:null==r?void 0:r.image})}))}addFriend(e){return r(this,void 0,void 0,(function*(){return yield this.webClient.addFriend(this.getUserId(),{friendId:e})}))}removeFriend(e){return r(this,void 0,void 0,(function*(){return yield this.webClient.removeFriend(this.getUserId(),{friendId:e})}))}getUserId(){const e=this.auth.getFRVRID();if(null===e)throw new X("not logged in");return e}onAuthStatusChange(e){e&&this.syncFriends()}shareMessage(e){return this.socialPlatform.shareMessage(e)}sendUpdate(e){return this.socialPlatform.sendUpdate(e)}invite(e){return this.socialPlatform.invite(e)}getFriends(){return this.socialPlatform.getFriends()}getSupportedAPIs(){return this.socialPlatform.getSupportedAPIs()}isSupportedAPI(e){return this.socialPlatform.isSupportedAPI(e)}}class X extends Error{constructor(e){super(e)}}const Z={getId:()=>"",isInRoom(){return r(this,void 0,void 0,(function*(){return!1}))},getRoomData(){return r(this,void 0,void 0,(function*(){return{}}))},getRoomId(){return r(this,void 0,void 0,(function*(){return""}))},getPlayers(){return r(this,void 0,void 0,(function*(){return[]}))},getSupportedAPIs:()=>[],isSupportedAPI:e=>!1};class ee{constructor(e){var t;this.auth=e.auth,this.provider=null!==(t=e.provider)&&void 0!==t?t:Z}isInRoom(){return this.provider.isInRoom()}getRoomId(){return this.provider.getRoomId()}getRoomData(){return this.provider.getRoomData()}getPlayers(){return this.provider.getPlayers()}getSupportedAPIs(){return this.provider.getSupportedAPIs()}isSupportedAPI(e){return this.provider.isSupportedAPI(e)}}var te;!function(e){e[e.getRoomData=0]="getRoomData",e[e.isInRoom=1]="isInRoom",e[e.getRoomId=2]="getRoomId",e[e.getPlayers=3]="getPlayers",e[e.subscribeToPlayerJoined=4]="subscribeToPlayerJoined",e[e.subscribeToPlayerLeft=5]="subscribeToPlayerLeft"}(te||(te={}));const re="coeus.frvr.com/v1/tm5";function se(e=(()=>new XMLHttpRequest),t){let s;const i=[];let o=null;const n=!t&&navigator&&"function"==typeof navigator.sendBeacon;let a=!1;const d={protocol_version:"f",app_version:"av",engine_version:"ev",app_build:"ab",cohort:"co",channel:"ch",cmp_consents:"cmpc",cmp_legitimateInterests:"cmpl",games_played:"gp",play_session_id:"pi",play_session_count:"pc",days_elapsed:"de",facebook_player_id:"fi",facebook_context_type:"fc",facebook_entrypoint:"fe",facebook_referral_player_id:"fr",utm_source:"us",utm_medium:"um",utm_campaign:"uc",utm_term:"ut",utm_content:"uo",remote_user_id:"ru",global_user_id:"guid",device_width:"dw",device_height:"dh",non_interaction:"ni",country:"ct",event:"e",game:"g",user:"u",client_time:"t",value:"v",provider:"ao",ad_result:"ar",ad_response:"ag",ad_point:"ap",transport:"tr",web_url:"wu",retry:"r",label:"l",advertisement_id:"ai",script_version:"xv",cache_buster:"n",page_session_id:"si"};function c(e,t,r){r=void 0!==r?r:5,e(t,(function(){if(r>0){const s=5e3*(Math.pow(2,5-r)+Math.random());t.r=5-r+1,setTimeout(c.bind(void 0,e,t,--r),s)}}))}function h(e,t,r){if(navigator.sendBeacon(e,JSON.stringify(t)))return!0;r()}function l(t,r,s){let i=e();i.overrideMimeType&&i.overrideMimeType("text/plain; charset=UTF-8");try{i.open("POST",t,!0),i.setRequestHeader("Content-type","text/plain; charset=UTF-8"),i.withCredentials=!0,i.onreadystatechange=function(){if(4==i.readyState){const e=i.status;i=i.onreadystatechange=null,200!=e&&204!=e?s():a=!0}},i.send(JSON.stringify(r))}catch(e){s()}}function u(e,t,r){t.n=Math.random();const s=document.createElement("img");s.onload=function(){a=!0,s.onerror=s.onload=null},s.onerror=function(){r(),s.onerror=null},s.src=e+"?"+function(e){const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+(void 0!==e[r]&&null!=e[r]?encodeURIComponent(e[r]):""));return t.join("&")}(t),document.body.appendChild(s)}function g(e,t){return n&&a?(t.transport="bcn",h.bind(void 0,e)):XMLHttpRequest?(t.transport="xhr",l.bind(void 0,e)):(t.transport="img",u.bind(void 0,e+"/i"))}function v(e){const t=e.channel;let r;document&&document.location&&document.location.href&&(r=document.location.href);const i=null==s?void 0:s.getGlobalUserId(),o=null==s?void 0:s.getUserSource(),n=["https://",re,e.context||"_unspecified_",i||""].join("/");e.app_version=e.app_version||"0.0.0",e.app_build=e.app_build||"000000",e.channel=t||e.channel,e.web_url=r,e.script_version="2.0.1",e.protocol_version=5,e.cache_buster=Math.random(),e.referrer=document.referrer||null,void 0!==i&&(e.global_user_id=i),void 0!==o&&(e.global_user_id_source=o);const a=60*(new Date).getTimezoneOffset()*1e3;e.client_time=new Date(Date.now()-a).toISOString().slice(0,-1);c(g(n,e),function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&null!=e[r]&&(t[d[r]||r]=e[r]);return t}(e))}return{init(e,t){return r(this,void 0,void 0,(function*(){s=t}))},getName:()=>"FRVRAnalytics",send(e,t,r,s){var n;r=void 0!==t?Object.assign(Object.assign(Object.assign({value:t},r),s),{event:e}):Object.assign(Object.assign(Object.assign({},r),s),{event:e}),n=r,i.push(n),o&&clearTimeout(o),o=setTimeout((function(){for(;i.length>0;)v(i.shift())}),1)}}}var ie;e.AnalyticsIDProviderStorageType=void 0,(ie=e.AnalyticsIDProviderStorageType||(e.AnalyticsIDProviderStorageType={})).IN_MEMORY="in-memory",ie.COOKIE="cookie",ie.LOCAL_STORAGE="localStorage";const oe={init:()=>r(void 0,void 0,void 0,(function*(){})),getName:()=>"",getUserSource:()=>e.AnalyticsIDProviderStorageType.IN_MEMORY,getPageSessionId:()=>"",getPlaySessionId:()=>"",getGlobalUserId:()=>""};function ne(e){return(e<10?"0":"")+e}function ae(e){const t=e||"-";function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}const s=(new Date).getTime().toString(16).slice(0,11)+(65536*(1+Math.random())|0).toString(16).substring(1,2);return r()+r()+t+r()+t+r()+t+r()+t+s}class de{constructor(t){this.storage=t,this.PLAY_SESSION_TIMEOUT=18e5,this.globalUserIdSource=e.AnalyticsIDProviderStorageType.COOKIE,this.canUseCookies=!1}setCanUseCookies(){document&&void 0!==document.cookie?(document.cookie="can_use_cookies=test;",this.canUseCookies=document.cookie.indexOf("can_use_cookies")>-1):this.canUseCookies=!1}init(){return r(this,void 0,void 0,(function*(){this.setCanUseCookies(),this.canUseCookies?this.globalUserIdSource=e.AnalyticsIDProviderStorageType.COOKIE:this.storage.isPersistent()?this.globalUserIdSource=e.AnalyticsIDProviderStorageType.LOCAL_STORAGE:this.globalUserIdSource=e.AnalyticsIDProviderStorageType.IN_MEMORY;const t=yield this.storage.getItems(["pageSessionId","playSessionId","playSessionIdTimeStamp","globalUserId"]);this.pageSessionId=t.pageSessionId&&String(t.pageSessionId),this.playSessionId=t.playSessionId&&String(t.playSessionId),this.playSessionIdTimeStamp=t.playSessionIdTimeStamp&&parseInt(String(t.playSessionIdTimeStamp),10),this.globalUserId=t.globalUserId&&String(t.globalUserId)}))}getName(){return"FRVRAnalytics"}getUserSource(){return this.globalUserIdSource}getPageSessionId(){return this.pageSessionId||(this.pageSessionId=ae(),this.storage.setItem("pageSessionId",this.pageSessionId)),this.pageSessionId}getPlaySessionId(){if(this.playSessionId){this.playSessionIdTimeStamp+this.PLAY_SESSION_TIMEOUT<Date.now()&&(this.playSessionId=void 0)}return this.playSessionId||(this.playSessionId=ae(),this.storage.setItem("playSessionId",this.playSessionId)),this.playSessionIdTimeStamp=Date.now(),this.storage.setItem("playSessionIdTimeStamp",this.playSessionIdTimeStamp),this.playSessionId}getGlobalUserId(){return this.canUseCookies?this.getGlobalUserIdFromCookie():this.getGlobalUserIdFromStorage()}getGlobalUserIdFromStorage(){return this.globalUserId||(this.globalUserId=ae(),this.storage.setItem("globalUserId",this.globalUserId)),this.globalUserId}getGlobalUserIdFromCookie(){const e=document.cookie.match("^(?:.*_frvr=([^;]*)).*$");return this.globalUserId=e&&e[1]||ae(),this.refreshUserIdCookie(this.globalUserId),this.globalUserId}refreshUserIdCookie(e){const t=new Date;t.setDate(t.getDate()+730),document.cookie="_frvr="+e+"; path=/; expires="+new Date(t).toUTCString()+"; domain="+function(){const e=document.location.hostname.split(".");for(let t=e.length-1;t>=0;t--){const r=e.slice(t).join(".");if(document.cookie="get_tld=test;domain=."+r+";",document.cookie.indexOf("get_tld")>-1)return document.cookie="get_tld=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",r}return""}()+";"}}function ce(e){function t(){var e,t;return window.innerHeight||(null===(e=document.documentElement)||void 0===e?void 0:e.clientHeight)||(null===(t=document.body)||void 0===t?void 0:t.clientHeight)}const r=function(e){const t=t=>{const r=e.match(`^(?:.*${t}=([^&]*)|).*$`);return null==r?void 0:r[1]};return{utm_source:t("utm_source"),utm_medium:t("utm_medium"),utm_campaign:t("utm_campaign"),utm_term:t("utm_term"),utm_content:t("utm_content")}}((document.location.search||"").replace(/^\?/,""));return s=>{return Object.assign(Object.assign({},r),{play_session_id:s.getPlaySessionId(),channel:e,device_width:window.innerWidth||(null===(i=document.documentElement)||void 0===i?void 0:i.clientWidth)||(null===(o=document.body)||void 0===o?void 0:o.clientWidth),device_height:t()});var i,o}}class he{constructor(t,r){this.consentsBitSet=e.ConsentOptions.None,this.legitimateInterestsBitSet=e.ConsentOptions.None,this.consentIsLoaded=!1,this.getName=()=>"TcfV2ConsentProvider",this.logger=r,this.onConsentChangedHandlers=[],this.loadConsentManagementPlatform(t)}tcfDataBitSet2ConsentOptionsBitSet(e){let t=0;for(const r in e)e[r]&&(t|=1<<Number(r));return t}onLoad(){var e;if(window.__tcfapi){null===(e=this.logger)||void 0===e||e.log(`${this.getName()}::onLoad()`);const t=(e,t)=>{var r,s,i;t?"useractioncomplete"!==e.eventStatus&&"tcloaded"!==e.eventStatus||(this.consentIsLoaded=!0,this.consentsBitSet=this.tcfDataBitSet2ConsentOptionsBitSet(null!==(s=e.purpose.consents)&&void 0!==s?s:{}),this.legitimateInterestsBitSet=this.tcfDataBitSet2ConsentOptionsBitSet(null!==(i=e.purpose.legitimateInterests)&&void 0!==i?i:{}),this.dispatchConsentChanged(this.consentsBitSet,this.legitimateInterestsBitSet)):null===(r=this.logger)||void 0===r||r.warn(`${this.getName()}::onLoad::updateConsentCallback:!success`)};window.__tcfapi("addEventListener",2,t)}}dispatchConsentChanged(e,t){for(let r=0;r<this.onConsentChangedHandlers.length;r++)this.onConsentChangedHandlers[r](e,t)}hasLoaded(){return this.consentIsLoaded}loadConsentManagementPlatform(e){let t=1;const r=()=>{window.__tcfapi?this.onLoad():(setTimeout(r,t),t*=2,t>4e3&&(t=4e3))};r()}consentToTerms(){var e;null===(e=this.logger)||void 0===e||e.warn(`${this.getName()}::consentToTerms(NoOpImpl)`)}onConsentChanged(e){this.onConsentChangedHandlers.push(e),this.consentIsLoaded&&e(this.consentsBitSet,this.legitimateInterestsBitSet)}hasConsentForAny(t,r=e.ConsentOptions.None){return this.hasLoaded()&&0!=(this.consentsBitSet&t)}hasConsentForAll(t,r=e.ConsentOptions.None){return this.hasLoaded()&&(this.consentsBitSet&t)==t}consents(){return this.consentsBitSet}legitimateInterests(){return this.legitimateInterestsBitSet}}class le{constructor(e){this.decode(e)}getRightmost1Index(){return this.bits.lastIndexOf("1")}is1AtIndex(e){return e>=0&&"1"===this.bits.substr(e,1)}set1AtIndex(e){this.bits=this.bits.substr(0,e)+"1"+this.bits.substr(e+1)}decode(e){return/^0x[a-f0-9]*$/i.test(e)||(e="0x"+(Number(e)||0).toString(2).split("").reverse().join("").toString()),e=e.substring(2),this.bits=e.split("").map((function(e){let t=parseInt(e,16).toString(2);for(;t.length<4;)t="0"+t;return t})).join("")}encode(){return"0x"+this.bits.match(/(.{1,4})/g).map((function(e){for(;e.length<4;)e+="0";return parseInt(e,2).toString(16)})).join("")}}class ue{constructor(){this.PLAY_SESSION_TIMEOUT=18e5,this.randomPageSessionId=ae(),this.randomPlaySessionId=ae(),this.randomGlobalUserId=ae(),this.randomPlaySessionIdTimeStamp=Date.now()}init(){return r(this,void 0,void 0,(function*(){}))}getName(){return"random"}getUserSource(){return e.AnalyticsIDProviderStorageType.IN_MEMORY}getPageSessionId(){return this.randomPageSessionId}getPlaySessionId(){return this.randomPlaySessionIdTimeStamp+this.PLAY_SESSION_TIMEOUT<Date.now()&&(this.randomPlaySessionId=ae()),this.randomPlaySessionIdTimeStamp=Date.now(),this.randomPlaySessionId}getGlobalUserId(){return this.randomGlobalUserId}}class ge{constructor({analyticsProviders:e,idProvider:t,consentProvider:r,contextProvider:s,storage:o,logger:n,appContextFields:a}={}){this.ANALYTICS_STORAGE_KEY="__frvr_analytics_storage",this.FTUE_STEPS_DONE_KEY="__frvr_ftue_steps_done",this.data={},this.extraFieldFunctions=[],this.MAX_PRE_CONSENT_LOAD_EVENT_QUEUE=100,this.preConsentLoadEventQueue=[],this.randomIdProvider=new ue,this.analyticsProviders=null!=e?e:[],this.idProvider=null!=t?t:oe,this.consentProvider=null!=r?r:new he,this.storage=null!=o?o:c,this.logger=null!=n?n:i,this.contextProvider=s,this.timeStart=Date.now(),this.appContextFields=null!=a?a:{}}loadStorage(){return r(this,void 0,void 0,(function*(){this.data=yield this.storage.getItem(this.ANALYTICS_STORAGE_KEY,{})}))}updateStorage(){this.storage.setItem(this.ANALYTICS_STORAGE_KEY,Object.assign({},this.data))}getContextFields(){const e=this.data.game_start_time,t=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.appContextFields),this.contextProvider(this)),this.getConsentContextFields()),{page_session_id:this.getConsentedIdProvider().getPageSessionId(),play_session_id:this.getConsentedIdProvider().getPlaySessionId()}),this.data),{game_duration:void 0!==e?-1===e?0:Date.now()-e:void 0,loading_time:void 0===this.timeLoaded?void 0:this.timeLoaded-this.timeStart});for(const e of this.extraFieldFunctions)e(t);return t}dispatchOutstandingEvents(){const e=this.preConsentLoadEventQueue;for(;e.length>0;){const{event:t,value:r,fields:s,context:i,requiredConsents:o,requiredLegitimateInterests:n}=e.shift();this.dispatchEvent(t,r,s,Object.assign(Object.assign({},i),this.getConsentContextFields()),o,n)}}dispatchEvent(e,t,r,s,i,o){for(const n of this.analyticsProviders)try{this.consentProvider.hasConsentForAll(i,o)&&n.send(e,t,r,s)}catch(e){this.logger.error(`[frvr-tracker] error sending event via provider ${n.getName()}`,e)}}getConsentContextFields(){return{cmp_consents:this.consentProvider.consents(),cmp_legitimateInterests:this.consentProvider.legitimateInterests()}}send(e,t,r,s,i){const o=this.getContextFields();for(const e in r)void 0===r[e]&&delete r[e];for(const e in o)void 0===o[e]&&delete o[e];this.logger.log("[frvr-tracker] event",e,r,o),this.consentProvider.hasLoaded()?(this.dispatchOutstandingEvents(),this.dispatchEvent(e,t,r,Object.assign(Object.assign({},o),this.getConsentContextFields()),s,i)):this.preConsentLoadEventQueue.length<this.MAX_PRE_CONSENT_LOAD_EVENT_QUEUE&&this.preConsentLoadEventQueue.push({event:e,value:t,fields:r,context:o,requiredConsents:s,requiredLegitimateInterests:i})}init(){return r(this,void 0,void 0,(function*(){!function(e){const t=window.onerror;window.onerror=(r,s,i,o,n)=>{if(t)try{t(r,s,i,o,n)}catch(e){}if(r=String(r),n=n||new Error(r))try{e({msg:r,line:i,col:o,label:n.stack||JSON.stringify(n)})}catch(e){}return!1};const r=window.onunhandledrejection?window.onunhandledrejection.bind(window):null;window.onunhandledrejection=t=>{if(r)try{r(t)}catch(e){}try{const r=t&&t.reason||{};e({msg:r.message,line:0,col:0,label:"unhandled_rejection: "+(r.stack||JSON.stringify(r))})}catch(e){}}}((t=>this.logEvent("error",t,e.ConsentOptions.None))),yield this.loadStorage(),yield Promise.all([this.idProvider.init(),this.randomIdProvider.init()]),yield Promise.all(this.analyticsProviders.map((e=>e.init(this.consentProvider,this))))}))}loaded(){this.timeLoaded=Date.now(),this.logEvent("game_loaded",{},e.ConsentOptions.P10DevelopAndImproveProducts)}set(e,t){return this.data[e]=t,this.updateStorage(),t}inc(e,t){const r=(this.data[e]||0)+(void 0===t?1:t);return this.set(e,r),r}logEvent(t,r,s=e.ConsentOptions.None,i=e.ConsentOptions.None){this.send(t,void 0,r,s,i)}logValuedEvent(t,r,s,i=e.ConsentOptions.None,o=e.ConsentOptions.None){this.send(t,r,s,i,o)}logDiscoveryPageView(t){this.send("discovery_page_view",void 0,t,e.ConsentOptions.None,e.ConsentOptions.None)}getPlaySessionId(){return this.getConsentedIdProvider().getPlaySessionId()}getGlobalUserId(){return this.getConsentedIdProvider().getGlobalUserId()}getUserSource(){return this.getConsentedIdProvider().getUserSource()}addExtraFieldFunction(e){return this.extraFieldFunctions.push(e),()=>{const t=this.extraFieldFunctions.indexOf(e);-1!==t&&this.extraFieldFunctions.splice(t,1)}}ftue(t,r,s){const i=new le(this.data.ftuestepsdone);if(t<=i.getRightmost1Index())return void this.logger.warn("[frvr-tracker] ftue:",`step ${t} (${r}) has already been tracked`);i.set1AtIndex(t),this.set("ftuestepsdone",i.encode());const o=Object.assign(Object.assign({},s),{step_number:t,step_name:r});this.logEvent("ftue",o,e.ConsentOptions.P6PersonalizedContent|e.ConsentOptions.P5PersonalizedContentProfile|e.ConsentOptions.P8MeasureContentPerformance|e.ConsentOptions.P9MarketResearchForAudienceInsights|e.ConsentOptions.P10DevelopAndImproveProducts)}ftueUnordered(t,s,i){return r(this,void 0,void 0,(function*(){const r=yield this.storage.getItem(this.FTUE_STEPS_DONE_KEY,[]);if(r.find((e=>e===t)))return void this.logger.warn("[frvr-tracker] ftue:",`step ${t} (${s}) has already been tracked`);r.push(t),this.storage.setItem(this.FTUE_STEPS_DONE_KEY,r);const o=Object.assign(Object.assign({},i),{step_number:t,step_name:s});this.logEvent("ftue",o,e.ConsentOptions.P6PersonalizedContent|e.ConsentOptions.P5PersonalizedContentProfile|e.ConsentOptions.P8MeasureContentPerformance|e.ConsentOptions.P9MarketResearchForAudienceInsights|e.ConsentOptions.P10DevelopAndImproveProducts)}))}levelStart(t,r){const s=Object.assign(Object.assign({},r),{level_id:t});this.set("game_start_time",Date.now()),this.inc("games_played");const i=function(){const e=new Date;return e.getUTCFullYear()+"-"+ne(e.getUTCMonth()+1)+"-"+ne(e.getUTCDate())}();this.data.last_day_played!==i&&(this.set("last_day_played",i),this.inc("days_played"));const o=this.inc("play_session_count");this.logValuedEvent("game_play_start",o,s,e.ConsentOptions.P8MeasureContentPerformance|e.ConsentOptions.P10DevelopAndImproveProducts)}levelEnd(t,r){const s=Object.assign(Object.assign({},r),{level_id:t});this.logEvent("game_end",s,e.ConsentOptions.P8MeasureContentPerformance|e.ConsentOptions.P10DevelopAndImproveProducts),this.set("game_start_time",-1)}getConsentedIdProvider(){return this.consentProvider.hasConsentForAll(e.ConsentOptions.P1StoreInformationOnADevice,e.ConsentOptions.None)?this.idProvider:this.randomIdProvider}}for(var ve=[],pe=0;64>pe;)ve[pe]=0|4294967296*Math.abs(Math.sin(++pe));class fe{constructor({tracker:e,logger:t=i}){this.initialized=!1,this.forcedCohorts={},this.abTestCohorts={},this.onInitReadyCbs=[],this.abTestEnabled=!0,this.tracker=e,this.logger=t}force(e,t){this.logger.warn(`[frvr-abtest] init: Forcing cohort ${t} for test ${e}`),this.forcedCohorts[e]=t}init(e,t){return r(this,void 0,void 0,(function*(){if(this.logger.debug(`[frvr-abtest] init: Initializing A/B tests with id ${e}`),t){for(const r in t)t[r].active&&this.addTest(e,r,t[r].cohorts,!1);if(this.logger.debug("[frvr-abtest] init: A/B tests cohorts:",this.abTestCohorts),this.abTestEnabled){for(const e in t)t[e].active&&this.tracker.logValuedEvent("ab_test_activation",1,{ab_test_name:e,ab_test_group:this.abTestCohorts[e]});this.tracker.addExtraFieldFunction((e=>{if(this.abTestEnabled)for(const r in t)t[r].active&&(e[`abt_${r}`]=this.abTestCohorts[r])}))}else this.logger.debug("[frvr-abtest] init: A/B tests disabled.")}else this.logger.debug("[frvr-abtest] init: No A/B tests are defined.");this.initialized=!0;for(let e=0;e<this.onInitReadyCbs.length;e++)this.onInitReadyCbs[e]()}))}addTest(e,t,r,s){let i=this.forcedCohorts[t];return i&&-1==r.indexOf(i)&&this.logger.error(`[frvr-abtest] Forced cohort doesn't exist: ${this.forcedCohorts[t]}.Valid cohorts are:`,r),i||(i=r[function(e,t,r){const s=function(e){for(var t,r,s,i,o=[],n=(e=unescape(encodeURI(e))).length,a=[t=1732584193,r=-271733879,~t,~r],d=0;d<=n;)o[d>>2]|=(e.charCodeAt(d)||128)<<d++%4*8;for(o[e=16*(n+8>>6)+14]=8*n,d=0;d<e;d+=16){for(n=a,i=0;64>i;)n=[s=n[3],(t=0|n[1])+((s=n[0]+[t&(r=n[2])|~t&s,s&t|~s&r,t^r^s,r^(t|~s)][n=i>>4]+(ve[i]+(0|o[[i,5*i+1,3*i+5,7*i][n]%16+d])))<<(n=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*n+i++%4])|s>>>32-n),t,r];for(i=4;i;)a[--i]=a[i]+n[i]}for(e="";32>i;)e+=(a[i>>3]>>4*(1^7&i++)&15).toString(16);return e}(t+":"+e).substr(-8);return parseInt(s,16)%r}(e,t,r.length)]),this.abTestCohorts[t]=i,s&&this.abTestEnabled&&this.tracker.logValuedEvent("ab_test_activation",1,{ab_test_name:t,ab_test_group:this.abTestCohorts[t]}),{test:t,cohort:i}}cohort(e){if(!this.initialized)throw new Error("[frvr-abtest] cohort: Called before initialization!");if(!this.abTestEnabled)return;const t=this.abTestCohorts[e];return void 0===t&&this.logger.error(`[frvr-abtest] cohort: No cohort defined for test: ${e} - did you misspell your test name? Tests:`,this.abTestCohorts),t}switch(e,t){if(!this.abTestEnabled)return{fallback:function(e){e&&e()}};if(!this.initialized)throw new Error("[frvr-abtest] switch: Called before initialization!");const r=this.cohort(e);return r&&t[r]&&t[r](),{fallback:function(){}}}onInitReady(e){this.initialized?e():this.onInitReadyCbs.push(e)}}const me={chromeWrapper:"chromeos",androidWrapper:"android",iOSWrapper:"ios",rcs:"rcs",samsungAppStore:"samsung_galaxy_store",facebookInstant:"facebook_instant",facebookRooms:"facebook_rooms",facebookAppWeb:"facebook_canvasweb",facebookApp:"facebook_canvas",samsungBixby:"bixby",samsungGameLauncher:"samsung_game_launcher",samsungInstantPlay:"samsung_instant_play",spilGamesWrapper:"spil",vkru:"vkru",okru:"okru",kik:"kik",twitter:"twitter",twitch:"twitch",hago:"hago",oppoGlobal:"oppo_global",tMobile:"tmobile",huawei:"huawei",huaweiquickapp:"huawei_quick_app",yandex:"yandex",crazyGames:"crazy_games",lgtv:"lg_tv",jioStb:"jio_stb",myJio:"jio_my",jioGameslite:"jio_gameslite",rocketChat:"rocket_chat",ufone:"ufone",game8:"game8",mailonline:"mail_online",discord:"discord",harman:"harman"},Ie="frvr",ye={7978894035:"samsung_game_launcher",7640790291:"bixby",3704760038:"legacy_samsung_daily",4056808137:Ie,3238562380:"samsung_instant_play",5374938192:Ie,5362404538:Ie,9165482691:Ie,1661744930:Ie,1781508157:Ie,1526015108:"legacy_samsung_browser_us",9152813246:"legacy_samsung_gl_fallback",1570234097:"bixby",6159024522:"telenorpk",9547456458:"huawei_quick_app",4901070532:Ie,5509479103:Ie,4687607673:Ie,7772201439:Ie,5781080938:Ie,7859627468:"bixby",6225636036:Ie,9257964653:Ie,9997971842:"legacy_samsung_gl_pwa",1810535265:Ie,6879406107:Ie,5664912848:Ie,7871893264:"oppo_global",6905222938:"1001spill",1074763396:Ie,4822698373:"huawei",3917207338:Ie,3091839955:Ie,9511672440:Ie,9609759920:Ie,8846287731:Ie,1912410415:Ie,3463089052:Ie,3138478138:"spil",3609613151:Ie,7259516105:Ie,8260783143:Ie,4791934430:Ie,5304245228:Ie,4196077731:Ie,7517011737:"ga",1420430092:Ie,6341560802:Ie,3188724532:Ie,7430391555:"samsung_galaxy_store_pwa",6142190935:Ie,2410146e3:"spil",6238202936:Ie,2165771095:Ie,7169566203:Ie,7116648941:Ie,9484119302:Ie,8289067739:"crazy_games",4942292965:Ie,4111954147:"samsung_instant_daily",9508446909:"mozilla_lite",6581072258:Ie,6305391737:Ie,7721350107:Ie,5689634745:Ie,4407671492:Ie,8793151713:"mynet",6701854007:Ie,8166612510:Ie,1204043211:Ie,8540348735:Ie,8092992494:Ie,3050063345:Ie,6105016100:Ie,5383746593:Ie,2155121367:Ie,4481639214:Ie,9167804042:Ie,2633738716:Ie,5732840388:Ie,1136474154:Ie,3868538934:Ie,6791411817:Ie,4001058104:"spil",8323344707:Ie,1511956590:Ie,5337609782:Ie,7647348124:Ie,9465676615:Ie,8699389853:Ie,8288405339:"ga",1601204168:Ie,6738957149:Ie,3143968130:"spil",3660984936:"legacy_all_samsung_browser",6672071330:"ga",9944902462:Ie,4216099801:"ga",9810477030:Ie,4127083129:Ie,9831349735:"mediatrust",1651142765:Ie,2402315798:Ie,3217022605:"rcs",8209630496:Ie,7348809119:Ie,1907949320:Ie,7711130568:Ie,6682900564:Ie,8220757253:Ie,9226003469:Ie,6459119768:"ga",3297429215:Ie,2066412442:Ie,9610826637:"spil",5428378892:Ie,3718604937:"ga",7010263033:Ie,5533541335:"spil",5393940535:"spil",6680931602:Ie,8135642444:Ie,5195338130:"ga",2443106993:Ie,9841433446:Ie,9471076165:"spil",8645981334:"clickjogos",9750454053:"spil",5496116299:"spil",9095657336:"spil",5196972230:Ie,1711991335:"spil",1463804937:"plonga",6650691459:Ie,7854536931:"spil",4185858062:Ie,1559694722:Ie,4196397436:"ga",5791200697:Ie,8838890658:Ie,6592001260:Ie,8990371880:"rocketchat",3078524176:Ie,1414057592:"spil",1721816412:"spil",7627870781:"samsung_instant_browser_us",7257814137:"spil",6687910134:"mfogs",6388800833:Ie,6794212012:"mailonline",2719344539:"spil",6005657456:Ie,4761469737:"spil",8260978605:Ie,4899645641:Ie,5570875049:"tron",3275762232:"spil",1433925895:"spil",7925670440:"taboola",3587369568:"squid",3982547231:Ie,4388062450:"spil",8471269857:"bixby",1323020937:"spil",3605255281:"bixby",9085283107:Ie,1873844328:"legacy_samsung_browser_m4s",8924310391:"bixby",7269966843:"tmobile",1075554580:"adsenseforgamestest2",1098459098:Ie,8199816817:"xiaomi"},Pe=window.location.href;const Se=function(e,t){let r="frvr";for(const t in me)e[t]&&(r=me[t]);const s=t();if(s){const e=ye[s];e&&(r=e)}return(window.location&&window.location.host&&"krunker.io"===window.location.host||"internal.krunker.io"===window.location.host)&&(r="krunker_io"),r},Ee=function(e,t){null!=e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)","i").exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},be=(e,t)=>function(r,s,i,o){const n={};return e&&(n[e]=!0),n.android=/(android)/i.test(i)&&!/(Windows)/i.test(i),n.androidVersion=function(){const e=navigator.userAgent.toLowerCase().match(/android\s([0-9\.]*)/);return parseFloat(e?e[1]:"0")}(),n.firefoxMobile=/(Mobile)/i.test(i)&&/(Firefox)/i.test(i),n.slow=n.android&&n.androidVersion<6,n.iOS=/(ipod|iphone|ipad)/i.test(i)||/(Macintosh)/i.test(i)&&"ontouchend"in document,n.windowsMobile=/(IEMobile)/i.test(i),n.silk=/(silk)/i.test(i),n.clay=/(clay\.io)/i.test(o),n.facebookApp=/(fb_canvas)/i.test(o),n.facebookAppWeb=/(fb_canvas_web)/i.test(o),n.iframed=r.top!==r.self,n.standalone="standalone"in s&&s.standalone,n.mobileiOSDevice=Boolean(i.match(/iPhone/i)||i.match(/iPod/i)),n.kongregate=/(kongregateiframe)/i.test(o),n.kik=/(kik_canvas)/i.test(o),n.twitter=/(twitter)/gi.test(i),n.chrome=/Chrome\//.test(i),n.safari=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),n.secureConnection=0==window.location.protocol.indexOf("https"),n.facebookInstant=!!window.FBInstant,n.facebookRooms=!!window.isFacebookRooms,n.spilGamesWrapper=/(spilgames)/i.test(o),n.social="on"==Ee(t,"social"),n.advertisementIsDisabled="off"==Ee(t,"ads"),n.advertisementInterstitialDisabled="off"==Ee(t,"int"),n.advertisementOverlayEnabled=!n.iframed||n.spilGamesWrapper||Boolean(Ee(t,"partnerid")),n.nosoc="1"==Ee(t,"nosoc"),n.facebookAd=/(\/\?fb)/i.test(o),n.mobile=n.android||n.windowsMobile||n.iOS||n.silk||n.firefoxMobile,n.iOSWrapper=!!r.iOSWrapper,n.iPhoneXOrLater="true"==Ee(t,"iPhoneXOrLater"),n.iMessageContext="true"==Ee(t,"iMessage"),n.androidWrapper=!!r.androidWrapper,n.chromeWrapper=!!r.isChromeWrapper,n.samsungAppStore="samsung"==Ee(t,"androidStore"),n.appWrapper=Boolean(r.iOSWrapper||r.androidWrapper||n.samsungAppStore),n.usingWebGLRenderer=!1,n.usingCanvasRenderer=!1,n.jioStb=!!n["jio-stb"],n.myJio=!!n.myjio,n.jioGameslite=!!n["jio-gameslite"],n.jio=n.jioStb||n.myJio||n.jioGameslite,n.twitch=""==Ee(t,"twitch"),n.vkru=""==Ee(t,"vkru"),n.okru=""==Ee(t,"okru"),n.tMobile=""==Ee(t,"tmobile"),n.pwa=""==Ee(t,"pwa"),n.windowsApp=""==Ee(t,"windowsapp"),n.enableAppStoreLinks=!0,n.samsungGalaxyStorePWA=""==Ee(t,"samsung")&&"galaxystore"==Ee(t,"source"),n.samsungGameLauncherPWA=(""==Ee(t,"pwa")||""==Ee(t,"samsung"))&&"gamelauncher"==Ee(t,"source"),n.samsungGameLauncher=!!window.FRVRInstant||(""==Ee(t,"gamelauncher")||"gamelauncher"==Ee(t,"source")),n.samsungBixby=""==Ee(t,"samsung")&&!n.samsungGalaxyStorePWA,n.samsungBrowserUK=""==Ee(t,"samsungbuk"),n.samsungBrowserUS=""==Ee(t,"samsungbus"),n.samsungBrowserSEA=""==Ee(t,"samsungbsea"),n.samsungBrowser=""==Ee(t,"samsungbrowser"),n.samsungGLFallback=""==Ee(t,"gl_fallback"),n.samsungInstantPlay=!!window.GSInstant,n.samsung=n.samsungGalaxyStorePWA||n.samsungGameLauncherPWA||n.samsungGameLauncher||n.samsungBixby||n.samsungBrowserUK||n.samsungBrowserUK||n.samsungBrowserUS||n.samsungBrowserSEA||n.samsungBrowser||n.samsungGLFallback||n.samsungInstantPlay,n.rcs=Boolean(Ee(t,"rcsid")),n.rcsKr=""==Ee(t,"rcskr"),n.huaweiquickapp=""==Ee(t,"huaweiquickapp"),n.huawei=""==Ee(t,"huawei")||n.huaweiquickapp,n.mozilla=""==Ee(t,"mozilla"),n.miniclip=""==Ee(t,"miniclip"),n.chromeOSDevice="true"==Ee(t,"isChromeOSDevice"),n.opera=!!r.opr&&!!r.opr.addons||!!r.opera||i.indexOf(" OPR/")>=0,n.yandex=!!window.YaGames,n.firefox=void 0!==r.InstallTrigger,n.edge=/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i.test(i),n.oppoGlobal=""==Ee(t,"oppo"),n.lgtv=""==Ee(t,"lgtv"),n.crazyGames="8289067739"==Ee(t,"partnerid"),n.mynet=""==Ee(t,"mynet"),n.ufone="8416254215"==Ee(t,"partnerid"),n.game8=""==Ee(t,"game8"),n.mailonline="6794212012"==Ee(t,"partnerid"),n.disableNativeBridge=""==Ee(t,"disableNativeBridge"),n.partnerWrapper=!n.disableNativeBridge&&(n.mynet||n.tMobile||n.ufone||n.mailonline)&&(n.iOS||n.android),n.rocketChat=""==Ee(t,"rocketchat"),n.discord="discord"===e,n.harman=""==Ee(t,"harman"),n.progressiveWebAppEnabled=!(n.chromeOSDevice||n.iframed||n.appWrapper||n.twitch||n.vkru||n.okru||n.facebookInstant||n.partnerWrapper),n.tv=n.jioStb||n.lgTV,n}(window,navigator,navigator.userAgent,String(window.location));const _e={getChannel:function(e,t,r){let s,i;return()=>{if(s)return s;var o,n,a;null!=i||(i=be(e,Pe)),null!=r||(o=Pe,n=i,a=t||{},r=()=>function(e,t,r){const s=Ee(e,"partnerid");if(s)return s;const i=[["samsungBrowser","3660984936"],["rcs","3217022605"],["huaweiquickapp","9547456458"],["huawei","4822698373"],["tMobile","7269966843"],["miniclip","8532226134"],["samsungBrowserSEA","2765561693"],["samsungBrowserUS","1526015108"],["samsungBrowserUK","2961002817"],["mozilla","9508446909"],["samsungBixby","7640790291"],["samsungGalaxyStorePWA","7430391555"],["samsungGameLauncherPWA","9997971842"],["samsungInstantPlay","3238562380"]];for(const[e,r]of i)if(t[e])return r;const o={ft_daily:"4111954147",ft_bixby:"7859627468",ft_browser_us:"7627870781",ft_browser_uk:"8436188448",default:"7978894035"},n={ft_daily:"3704760038",ft_bixby:"7640790291",ft_browser_us:"1526015108",ft_browser_uk:"2961002817",default:"9152813246"};return t.samsungGameLauncher?o[Ee(e,"source")]||o.default:Ee(e,"gl_fallback")||""===Ee(e,"gl_fallback")?n[Ee(e,"source")]||n.default:t.spilGamesWrapper&&r.googleAdSpilgamesId?r.googleAdSpilgamesId:!!r.googleAdSiteId&&r.googleAdSiteId}(o,n,a));const d=Se(i,r);return s=d,d}}("",{})},Te={getName:()=>"Empty Provider",init:()=>r(void 0,void 0,void 0,(function*(){})),configure:()=>r(void 0,void 0,void 0,(function*(){})),isReady:()=>!1,getCatalog:()=>({}),getProductById:()=>{},purchase:()=>r(void 0,void 0,void 0,(function*(){throw new Error("no products")})),consumePurchase:()=>{throw new Error("no products")},getUnconsumedPurchases:()=>r(void 0,void 0,void 0,(function*(){return[]})),onIsReadyChanged:function(){}},Re={logEvent:()=>{},logValuedEvent:()=>{}};class Ce{constructor(e,t){this.analytics=e,this.providerName=t}logRequestPaymentError(e,t){this.analytics.logValuedEvent("iap_request_payment_failed",1,Object.assign(Object.assign({},e),{err:t}))}logRequestPaymentSuccess(e,t){this.analytics.logValuedEvent("iap_request_payment_success",1,Object.assign(Object.assign({},e),{purchaseId:t.purchaseId}))}logRequestPayment(e){this.analytics.logValuedEvent("iap_request_payment",1,Object.assign({},e))}logConsumePurchase(e,t){this.analytics.logValuedEvent("iap_consume_purchase",1,Object.assign(Object.assign({},e),{purchaseId:t.purchaseId}))}logRestorePurchasesError(e){this.analytics.logValuedEvent("iap_request_restore_purchase_error",1,{provider:this.providerName,err:e})}logRestorePurchasesSuccess(){this.analytics.logValuedEvent("iap_request_restore_purchase_success",1,{provider:this.providerName})}logRestorePurchases(){this.analytics.logValuedEvent("iap_request_restore_purchase",1,{provider:this.providerName})}}var Ae;e.IAPErrorCode=void 0,(Ae=e.IAPErrorCode||(e.IAPErrorCode={})).UNKNOWN="UNKNOWN",Ae.USER_INPUT="USER_INPUT",Ae.INVALID_PARAM="INVALID_PARAM";class we extends Error{constructor(t,r,s=e.IAPErrorCode.UNKNOWN){super(t,r),this.code=s,Object.setPrototypeOf(this,we.prototype)}}class Oe extends we{constructor(t,r){super(t,r,e.IAPErrorCode.INVALID_PARAM),Object.setPrototypeOf(this,Oe.prototype)}}class ke extends we{constructor(t="Purchase cancelled by user",r){super(t,r,e.IAPErrorCode.USER_INPUT),Object.setPrototypeOf(this,ke.prototype)}}var Ne=Object.freeze({__proto__:null,get IAPErrorCode(){return e.IAPErrorCode},IAPError:we,IAPPurchaseErrorUnknownProduct:Oe,IAPPurchaseErrorCancelledByUser:ke});class Fe{constructor(e){this.errors=Ne,this.provider=e.provider||Te,this.iapTracker=new Ce(e.tracker||Re,this.provider.getName()),this.logger=e.logger||i}init(){return this.provider.init()}configure(e){return this.provider.configure(e)}isReady(){return this.provider.isReady()}onReady(e){this.provider.onIsReadyChanged(e)}getCatalog(){return this.provider.getCatalog()}getProductById(e){var t;const r=this.provider.getProductById(e);if(!r)return void this.logger.error("IAP. Product not found",e);const s=null!==(t=r.price)&&void 0!==t?t:`${r.currencyCode} ${r.priceValue}`;return Object.assign(Object.assign({},r),{price:s,provider:this.provider.getName(),productId:e})}purchase(e,t){return r(this,void 0,void 0,(function*(){const r=this.getProductById(e);if(this.iapTracker.logRequestPayment(r),!r)throw new Oe(`Unknown product "${e}"`);try{const s=yield this.provider.purchase(e,t);return this.iapTracker.logRequestPaymentSuccess(r,s),s}catch(e){const t=e.message||e.toString();if(this.iapTracker.logRequestPaymentError(r,t),e instanceof ke)throw this.logger.log("Purchase cancelled by user"),e;throw this.logger.error("Error in purchase: "+t,e),new we("Unexpected purchase error",{cause:e})}}))}consumePurchase(e){return r(this,void 0,void 0,(function*(){const t=this.getProductById(e.productId);this.iapTracker.logConsumePurchase(t,e);try{yield this.provider.consumePurchase(e)}catch(e){throw new we("Unexpected consume error",{cause:e})}return e.purchaseId}))}getUnconsumedPurchases(){return r(this,void 0,void 0,(function*(){this.iapTracker.logRestorePurchases();try{const e=yield this.provider.getUnconsumedPurchases();return this.iapTracker.logRestorePurchasesSuccess(),e}catch(e){const t=e.message||e.toString();this.iapTracker.logRestorePurchasesError(t),this.logger.error("Error in getUnconsumedPurchases: "+t,e)}return[]}))}requestPayment(e,t){return this.purchase(e,t)}restorePurchases(){return this.getUnconsumedPurchases()}getPurchases(){return this.getUnconsumedPurchases()}}class Le{constructor(){this.catalog=null,this.nextPurchaseId=0,this.purchasesNotConsumed={}}onIsReadyChanged(e){this.onIsReadyHandler=e}getName(){return"MockIAP"}init(){return r(this,void 0,void 0,(function*(){}))}configure(e){return r(this,void 0,void 0,(function*(){this.catalog=null==e?void 0:e.catalog,this.onIsReadyHandler&&this.onIsReadyHandler(!!this.catalog)}))}isReady(){return null!=this.catalog}getCatalog(){var e;return null!==(e=this.catalog)&&void 0!==e?e:{}}getProductById(e){var t;if(!this.catalog)return null;const r=null===(t=this.catalog[e])||void 0===t?void 0:t.label;return r?{trackingName:r,priceValue:"10",currencyCode:"USD",label:`${e} USD 10`}:null}purchase(e,t){return r(this,void 0,void 0,(function*(){if(!this.catalog)throw new Error("IAP Not ready");if(null==t?void 0:t.cancelled)throw new ke;if(!window.confirm(`[${this.getName()}] Confirm purchase?`))throw new Error("Purchase cancelled");const r=(++this.nextPurchaseId).toString();return this.purchasesNotConsumed[r]=e,{productId:e,purchaseId:r,channelId:"test",transactionReceipt:"receipt"}}))}consumePurchase(e){return this.catalog?(window.console.log(`[${this.getName()}] Purchase consumed:`,e),delete this.purchasesNotConsumed[e.purchaseId],Promise.resolve()):Promise.reject(new Error("IAP Not ready"))}getUnconsumedPurchases(){if(!this.catalog)return Promise.reject(new Error("IAP Not ready"));window.console.log(`[${this.getName()}] Purchases restored`);const e=[];for(const[t,r]of Object.entries(this.purchasesNotConsumed))e.push({productId:r,purchaseId:t,channelId:"test",transactionReceipt:"receipt"});return Promise.resolve(e)}}class De{constructor(t){var r;this.auth=t.auth,this.channelId=t.channelId,this.gameId=t.gameId,this.apiHost=null!==(r=t.apiHostOverride)&&void 0!==r?r:t.env===e.Env.PRODUCTION?"https://crucible.frvr.com/v1/iap":"https://staging.crucible.frvr.com/v1/iap"}fetch(e,t){return this.auth.authenticatedFetch(`${this.apiHost}/${this.channelId}/${e}`,t)}getPurchases(){return this.auth.authenticatedFetch(`${this.apiHost}/purchases/${this.auth.getFRVRID()}`,{method:"GET",body:"{}"}).then(this.validateAndReturnJSON)}validatePurchase(e,t={}){return this.auth.authenticatedFetch(`${this.apiHost}/validate/${this.channelId}/${this.gameId}`,Object.assign({method:"POST",body:JSON.stringify(e)},t)).then(this.validateAndReturnJSON)}consumePurchase(e,t){return this.auth.authenticatedFetch(`${this.apiHost}/consume/${this.channelId}/${this.gameId}`,{method:"POST",body:JSON.stringify({applicationId:e,transactionId:t})}).then(this.validateAndReturnJSON)}getProducts(){return fetch(`${this.apiHost}/products/${this.channelId}/${this.gameId}`,{method:"GET"}).then(this.validateAndReturnJSON)}validateAndReturnJSON(e){if(!e.ok)throw new Error(`IAPServiceClient bad response: ${e.status} ${e.statusText}`);return e.json()}}class Ue{scheduleMessage(e){return r(this,void 0,void 0,(function*(){const t=yield fetch("https://hermes.frvr.com/v1/scheduler",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return yield t.json()}))}}const Ve={logEvent:()=>{}};class je{constructor({provider:e,logger:t,tracker:r=Ve}){this.initialized=!1,this.provider=e,this.logger=t,this.chatbot=new Ue,this.tracker=r}init(){return r(this,void 0,void 0,(function*(){this.game?this.initialized=!0:this.logger.error("Notifications class should be configured before it is initialized")}))}configure(e){return r(this,void 0,void 0,(function*(){this.game=e.game}))}scheduleMessage(e){return r(this,void 0,void 0,(function*(){if(!this.initialized)throw this.logger.error("Chatbot can not be used until it has been initialized"),new Error("INVALID_OPERATION");const t={game:this.game,platform:this.provider.getName(),player_id:e.playerId,timetorun:e.delayInSeconds,template:{image_url:e.imageUrl,message:e.message,buttons:e.buttons}};return yield this.chatbot.scheduleMessage(t)}))}canScheduleMessages(){return this.provider.canScheduleMessages()}subscribeScheduleMessages(){return this.tracker.logEvent("bot_subscribe_show",{}),this.provider.subscribeScheduleMessages().then((e=>(e?this.tracker.logEvent("bot_subscribe_success",{}):this.tracker.logEvent("bot_subscribe_failure",{}),e))).catch((e=>(this.tracker.logEvent("bot_subscribe_failure",{}),!1)))}scheduleLocalNotification(e,t,r,s){return this.provider.scheduleLocalNotification(e,t,r,s)}}function xe(){this.code="INVALID_OPERATION",this.message="Trying to use an empty interface."}const Me={getName:()=>"",canScheduleMessages(){return r(this,void 0,void 0,(function*(){return!1}))},subscribeScheduleMessages(){return r(this,void 0,void 0,(function*(){return!1}))},scheduleLocalNotification:()=>Promise.reject(new xe)};class Be{constructor({id:e,contextID:t,endTime:r,startTime:s,title:i,payload:o,offset:n,players:a,type:d,count:c}){this.id=e,this.contextID=t,r&&(this.endTime=r),s&&(this.startTime=s),this.title=i,this.payload=o,this.offset=n,this.count=c,a&&(this.players=a),d&&(this.type=d)}}class Ge{constructor(e){this.id=e.id,this.name=e.name,this.photo=e.photo,this.rank=e.rank,e.updated&&(this.updated=e.updated),this.score=e.score,this.payload=e.payload}}const $e="TOURNAMENT",He={[e.Env.PRODUCTION]:"https://crucible.frvr.com",[e.Env.BETA]:"https://staging.crucible.frvr.com",[e.Env.DEVELOPMENT]:"https://staging.crucible.frvr.com"};class We{constructor(e){this.channel=e}init(e,t){this.apiUrl=He[t],this.gameId=e,this.leaderboards={}}createLeaderboard(e,t){return r(this,void 0,void 0,(function*(){const r=`${this.apiUrl}/v1/leaderboards`,s={game:this.gameId,title:t.title,endTime:t.endTime,type:e||"default",data:t.payload,sortOrder:t.sortOrder||"HIGHER_IS_BETTER"};t.id&&(s.id=t.id);const i=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=yield i.json();if(!i.ok)throw new Error(o.error.message);return o.id}))}getLeaderboard(e,t=30,s=0){return r(this,void 0,void 0,(function*(){const r=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}`,i={count:t.toString(),offset:s.toString()},o=yield fetch(r+"?"+new URLSearchParams(i)),n=yield o.json();if(!o.ok)throw new Error(n.error.message);n.payload=n.data;const a=n.players?n.players.map((t=>{const r=new Ge(t);return r.score=this.cacheScore(e,r.id,r.score),r})):[];return n.players=a,new Be(n)}))}getLeaderboardEntry(e,t){return r(this,void 0,void 0,(function*(){const r=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}/${t}`,s={platform:this.channel},i=yield fetch(r+"?"+new URLSearchParams(s)),o=yield i.json();if(!i.ok)throw new Error(o.error.message);return o.payload=o.data,o.score=this.cacheScore(e,t,o.score),new Ge(o)}))}submitScore(e,t,s,i,o){return r(this,void 0,void 0,(function*(){this.cacheScore(e,t,s);const r=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}`,n={id:t,score:s,platform:this.channel};i&&(n.name=i),o&&(n.photo=o);const a=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),d=yield a.json();if(!a.ok)throw new Error(d.error.message);return d}))}getAllLeaderboardsIdsOfType(e){return r(this,void 0,void 0,(function*(){return(yield this.getAllLeaderboardsOfType(Object.assign(Object.assign({},e),{verbose:!1}))).ids||[]}))}getAllLeaderboardsDataOfType(e){return r(this,void 0,void 0,(function*(){return(yield this.getAllLeaderboardsOfType(Object.assign(Object.assign({},e),{verbose:!0}))).leaderboards||[]}))}getLeaderboardEntries(e,t){return r(this,void 0,void 0,(function*(){if(!t.length)return[];const r=`${this.apiUrl}/v1/leaderboards/${this.gameId}/${e}/entries`,s={platform:this.channel,players:t.join(",")},i=yield fetch(r+"?"+new URLSearchParams(s)),o=yield i.json();if(!i.ok)throw new Error(o.error.message);return((null==o?void 0:o.entries)||[]).map((t=>(t.payload=t.data,t.score=this.cacheScore(e,t.id,t.score),new Ge(t))))}))}getAllLeaderboardsOfType({type:e,playerId:t,sortBy:s="created",sortOrder:i="desc",count:o=30,offset:n=0,verbose:a=!1}){return r(this,void 0,void 0,(function*(){const r=`${this.apiUrl}/v1/players/${this.gameId}/${t}`,d={type:e,platform:this.channel,sortOrder:i,sortBy:s,count:o.toString(),offset:n.toString(),verbose:a?"true":"false"},c=yield fetch(r+"?"+new URLSearchParams(d)),h=yield c.json();if(!c.ok)throw new Error(h.error.message);return h}))}cacheScore(e,t,r){this.leaderboards[e]||(this.leaderboards[e]={scores:{}});const s=this.leaderboards[e].scores[t];return void 0!==s&&s>r&&(r=s),this.leaderboards[e].scores[t]=r,r}}var Ke;!function(e){e[e.create=0]="create",e[e.getCurrentTournament=1]="getCurrentTournament",e[e.getActiveTournaments=2]="getActiveTournaments",e[e.postScore=3]="postScore",e[e.join=4]="join",e[e.leave=5]="leave",e[e.share=6]="share",e[e.invitePlayers=7]="invitePlayers"}(Ke||(Ke={}));class qe{constructor(e){this.provider=e,this.API=Ke}isSupported(){return this.provider.isSupported()}isSupportedAPI(e){return-1!==this.provider.getSupportedAPIs().indexOf(e)}getSupportedAPIs(){return this.provider.getSupportedAPIs()}create(e,t,r){return this.provider.create(e,t,r)}getActiveTournaments(){return this.provider.getActiveTournaments()}getCurrentTournament(){return this.provider.getCurrentTournament()}join(e){return this.provider.join(e)}leave(){return this.provider.leave()}share(e,t){return this.provider.share(e,t)}invitePlayers(e){return this.provider.invitePlayers(e)}}class Ye{constructor({provider:e,auth:t,logger:r,leaderboards:s}){this.provider=e,this.auth=t,this.logger=r,this.FRVRLeaderboards=s||new We(this.provider.getLeaderboardsChannelId()),this.platform=new qe(this.provider)}init(e,t){this.FRVRLeaderboards.init(e,t)}create(e,t){return r(this,void 0,void 0,(function*(){if(this.provider.isSupported()&&this.provider.getSupportedAPIs().includes(Ke.create)){const r=yield this.provider.create(0,e,t);return yield this.ensureCreated(r),r.id}return yield this.FRVRLeaderboards.createLeaderboard($e,{payload:e,title:t.title,endTime:t.endTime,sortOrder:t.sortOrder})}))}postScore(e,t,s,i){return r(this,void 0,void 0,(function*(){const r=this.getPlayerId();if(!r)throw new Error("Player is not logged in");const o=[this.FRVRLeaderboards.submitScore(e,r,t,s,i)];this.provider.getSupportedAPIs().includes(Ke.postScore)&&o.push(this.provider.postScore(e,t,s,i)),yield Promise.allSettled(o)}))}getMyTournaments(e,t){return r(this,void 0,void 0,(function*(){const r=this.getPlayerId();if(!r)throw new Error("Player is not logged in");const s={type:$e,count:e,offset:t,playerId:r};return this.FRVRLeaderboards.getAllLeaderboardsDataOfType(s)}))}getMyEntry(e){return r(this,void 0,void 0,(function*(){const t=this.getPlayerId();if(!t)throw new Error("Player is not logged in");return this.FRVRLeaderboards.getLeaderboardEntry(e,t)}))}getTournamentById(e,t,r){return this.FRVRLeaderboards.getLeaderboard(e,t,r)}ensureCreated(e){return r(this,void 0,void 0,(function*(){try{return void(yield this.FRVRLeaderboards.getLeaderboard(e.id))}catch(e){}yield this.FRVRLeaderboards.createLeaderboard($e,{id:e.id,payload:e.payload,title:e.title,endTime:e.endTime})}))}getPlayerId(){return this.auth.getFRVRID()}}const ze={isSupported:()=>!1,getSupportedAPIs:()=>[],getLeaderboardsChannelId:()=>"empty",getCurrentTournament(){return r(this,void 0,void 0,(function*(){return null}))},create(){return r(this,void 0,void 0,(function*(){return null}))},postScore(){return r(this,void 0,void 0,(function*(){}))},share(){return r(this,void 0,void 0,(function*(){}))},getActiveTournaments(){return r(this,void 0,void 0,(function*(){return[]}))},join(){return r(this,void 0,void 0,(function*(){}))},leave(){return r(this,void 0,void 0,(function*(){}))},invitePlayers(){return r(this,void 0,void 0,(function*(){}))}};class Je{constructor({logger:e,provider:t}){this.logger=e,this.provider=t,this.platform=this.provider.platform}init(e,t,s){return r(this,void 0,void 0,(function*(){return this.gameId=e,yield this.provider.init(e,this.logger,t,s)}))}create(e,t){return this.provider.create(e,t)}challengeByContextId(e,t,r){return this.provider.challengeByContextId(e,t,r)}challengeByPlayerId(e,t,r){return this.provider.challengeByPlayerId(e,t,r)}getPossibleOpponents(){return this.provider.getPossibleOpponents()}getCurrentChallengeId(){return this.provider.getCurrentChallengeId()}getCurrentChallengeData(){return this.provider.getCurrentChallengeData()}leave(){return this.provider.leave()}getAllChallenges(e,t){return this.provider.getAllChallenges(e,t)}getPlayerEntries(e,t){return this.provider.getPlayerEntries(e,t)}postScore({score:e,challengeId:t,name:r,photo:s,playerId:i}){return this.provider.postScore({score:e,challengeId:t,name:r,photo:s,playerId:i})}join(e){return this.provider.join(e)}nudge(e,t){return this.provider.nudge(e,t)}getOpponentsFromChallenges(e){return this.provider.getOpponentsFromChallenges(e)}getChallengesByOpponents(){return this.provider.getChallengesByOpponents()}getEntryPayload(){return this.provider.getEntryPayload()}isSupported(){return this.provider.isSupported()}}var Qe;!function(e){e.getID="context.getID",e.getType="context.getType",e.isSizeBetween="context.isSizeBetween",e.switch="context.switchAsync",e.choose="context.chooseAsync",e.create="context.createAsync",e.getPlayers="context.getPlayersAsync",e.update="updateAsync"}(Qe||(Qe={}));const Xe={platform:{API:Qe,getSupportedAPIs:()=>[],isSupportedAPI:()=>!1,getID:()=>"",getType:()=>"SOLO",isSizeBetween:()=>({answer:!1,minSize:0,maxSize:0}),switch:()=>Promise.resolve(),choose:()=>Promise.resolve(),create:()=>Promise.resolve(),getPlayers:()=>Promise.resolve([]),update:()=>Promise.resolve()},init(){return r(this,void 0,void 0,(function*(){}))},create(){return r(this,void 0,void 0,(function*(){return""}))},challengeByPlayerId(){return r(this,void 0,void 0,(function*(){return""}))},getPossibleOpponents(){return r(this,void 0,void 0,(function*(){return[]}))},challengeByContextId(){return r(this,void 0,void 0,(function*(){return""}))},getCurrentChallengeData(){return r(this,void 0,void 0,(function*(){}))},leave(){return r(this,void 0,void 0,(function*(){}))},getCurrentChallengeId:()=>"",getPlayerEntries(){return r(this,void 0,void 0,(function*(){return[]}))},getAllChallenges(){return r(this,void 0,void 0,(function*(){}))},postScore(){return r(this,void 0,void 0,(function*(){}))},join(){return r(this,void 0,void 0,(function*(){}))},nudge(){return r(this,void 0,void 0,(function*(){}))},getOpponentsFromChallenges(){return r(this,void 0,void 0,(function*(){}))},getChallengesByOpponents(){return r(this,void 0,void 0,(function*(){}))},getEntryPayload:()=>({}),isSupported:()=>!1},Ze={registrationSuccess:"registrationSuccess",registrationConflict:"registrationConflict",loginSuccess:"loginSuccess",accountNotActive:"accountNotActive",invalidCredentials:"invalidCredentials",invalidFormat:"invalidFormat",serverError:"serverError",unknownError:"unknownError",networkError:"networkError",operationSuccess:"operationSuccess",tokenExpired:"tokenExpired",notLoggedIn:"notLoggedIn",platformNotAvailable:"platformNotAvailable",platformLoginFail:"platformLoginFail,"},et={REG_SUCCESS:{type:Ze.registrationSuccess,success:!0,message:"User registered successfully. Pending confirmation"},LOGIN_SUCCESS:{type:Ze.loginSuccess,success:!0,message:"Login successful"},OPERATION_SUCCESS:{type:Ze.operationSuccess,success:!0,message:"Operation success"},REG_CONFLICT:{type:Ze.registrationConflict,success:!1,message:"Email already registered"},ACCOUNT_NOT_ACTIVE:{type:Ze.accountNotActive,success:!1,message:"Provided credentials are valid but account is either not confirmed or suspended"},INVALID_CREDENTIALS:{type:Ze.invalidCredentials,success:!1,message:"Provided credentials are invalid"},INVALID_FORMAT:{type:Ze.invalidFormat,success:!1,message:"Invalid format on data"},SERVER_ERROR:{type:Ze.serverError,success:!1,message:"Error on server"},UNKNOWN_ERROR:{type:Ze.unknownError,success:!1,message:"Unknown error"},NETWORK_ERROR:{type:Ze.networkError,success:!1,message:"Network Error"},TOKEN_EXPIRED:{type:Ze.tokenExpired,success:!1,message:"Token has expired. Request a new challenge to get a fresh one"},NOT_LOGGED_IN:{type:Ze.notLoggedIn,success:!1,message:"Cannot perform operation without active login"},PLATFORM_NOT_AVAILABLE:{type:Ze.platformNotAvailable,success:!1,message:"The requested platform is not available"},PLATFORM_LOGIN_FAIL:{type:Ze.platformLoginFail,success:!1,message:"The login on the requested platform failed"}};var tt=Object.freeze({__proto__:null,RESPONSE_TYPES:Ze,default:Ze,RESPONSE_DEFINITIONS:et});function rt(e){if(!e)return null;const t=e.split(".");if(3!=t.length)return null;const r=t[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(window.atob(r).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(s)}class st{constructor(e,t){this.refreshToken=t,this.accessToken=e}set accessToken(e){var t;this._accessToken=e;const r=rt(e);this._accessPayload=r,r?(this._accessExpiration=parseInt(null==r?void 0:r.exp,10)||0,this._accessIAT=parseInt(null==r?void 0:r.iat,10)||0,this._verified=!(!1===(null===(t=null==r?void 0:r.extra)||void 0===t?void 0:t.verified))):(this._accessExpiration=0,this._accessIAT=0,this._verified=!1)}get accessToken(){return this._accessToken}set refreshToken(e){var t;this._refreshToken=e;const r=rt(e);this._refreshPayload=r,r?(this._refreshExpiration=parseInt(null==r?void 0:r.exp,10),this._platform=null===(t=null==r?void 0:r.extra)||void 0===t?void 0:t.platform,this._frvrID=null==r?void 0:r.sub):(this._refreshExpiration=0,this._platform=null,this._frvrID=null)}get refreshToken(){return this._refreshToken}get accessExpiration(){return this._accessExpiration}get refreshExpiration(){return this._refreshExpiration}get platform(){return this._platform}get frvrID(){return this._frvrID}get isVerified(){return this._verified}get accessIssuedAt(){return this._accessIAT}get timeTillAccessExpiry(){return this.accessToken?Math.floor(this._accessExpiration-Date.now()/1e3):-1}get accessLifespan(){return this.accessToken?this._accessExpiration-this._accessIAT:0}updateTokens(e,t){this.accessToken=e,this.refreshToken=t}updateTokensIfValid(e,t){const r=this.accessToken,s=this.refreshToken;this.updateTokens(e,t),this.isAccessValid()&&this.isRefreshValid()||(this.accessToken=r,this.refreshToken=s)}isAccessValid(){return!!this._accessToken&&1e3*(this._accessExpiration-60)>Date.now()}isRefreshValid(){return!!this._refreshToken&&1e3*(this._refreshExpiration-60)>Date.now()}isAnyValid(){return this.isRefreshValid()||this.isAccessValid()}shouldRefresh(){return this.isRefreshValid()&&!this.isAccessValid()}getAccessPayload(){return this._accessPayload}getRefreshPayload(){return this._refreshPayload}}const it="__FRVR_auth_refresh_token",ot="__FRVR_auth_access_token";class nt{constructor(){this._currentPair=new st,this.pairsPerPlatform={}}initFromStorage(e=c){return r(this,void 0,void 0,(function*(){this.storage=e;const t=yield this.storage.getItem(it),r=yield this.storage.getItem(ot);this.currentPair=new st(r,t)}))}getAccessToken(){return this.currentPair.accessToken}getRefreshToken(){return this.currentPair.refreshToken}getFRVRID(){return this.currentPair.frvrID}isVerified(){return this.currentPair.isVerified}shouldRefresh(){return this.currentPair.shouldRefresh()}getCurrentPlatform(){return this.currentPair.platform}getAvailablePlatforms(){const e=[];for(const t in this.pairsPerPlatform)this.pairsPerPlatform[t].isAnyValid()&&e.push(t);return e}get availableTokens(){return this.pairsPerPlatform}setAsCurrent(e){this.currentPair=e,this.storage.setItem(it,e.refreshToken),this.storage.setItem(ot,e.accessToken)}addPairAsCurrent(e,t){const r=new st(e,t);this.setAsCurrent(r)}updateCurrentPair(e,t){this.setAsCurrent(new st(e,t))}updateAndValidateCurrentPair(e,t){return this.updateCurrentPair(e,t),this.isAccessValid()}deleteTokens(){this.currentPair=new st,this.pairsPerPlatform={},this.storage.removeItems([it,ot])}isAccessValid(){return this.currentPair.isAccessValid()}isRefreshValid(){return this.currentPair.isRefreshValid()}isAnyValid(){return this.currentPair.isAnyValid()}get currentPair(){return this._currentPair}set currentPair(e){this._currentPair=e,(null==e?void 0:e.platform)&&(this.pairsPerPlatform[e.platform]=e)}}var at;!function(e){e.FRVR="frvr",e.FACEBOOK_INSTANT="facebook-instant",e.FACEBOOK_SDK="facebook-web",e.GOOGLE_INTERNAL="google-internal",e.SAMSUNG_INSTANT="samsung-instant",e.APPLE="apple",e.DISCORD="discord",e.MICROSOFT="microsoft"}(at||(at={}));const dt={AUTH_REGISTRATION:{method:"POST",path:"/register"},AUTH_LOGIN:{method:"POST",path:"/login"},AUTH_REFRESH:{method:"POST",path:"/refresh"},AUTH_RECOVER:{method:"POST",path:"/recover"},AUTH_RECOVER_CHALLENGE:{method:"POST",path:"/recover-challenge"},AUTH_VERIFY:{method:"POST",path:"/verify"},AUTH_VERIFY_CHALLENGE:{method:"POST",path:"/verify-challenge"},AUTH_SETTINGS:{method:"POST",path:"/settings"},USER_VERIFIED:{method:"GET",path:"/user/verified"}};class ct{constructor(t={}){var r;this.apiBaseURL=(null===(r=t.config)||void 0===r?void 0:r.overrideBackendURL)||(t.env==e.Env.PRODUCTION?"https://crucible.frvr.com/v1/auth":"https://staging.crucible.frvr.com/v1/auth")}isLoggingIn(){return!!this.ongoingFRVRLogin}register(e){return r(this,void 0,void 0,(function*(){const t={platform:at.FRVR,credentials:e},r={201:()=>et.REG_SUCCESS,409:()=>{throw et.REG_CONFLICT}};return this.fetchAndHandleCommonErrors(dt.AUTH_REGISTRATION,r,t)}))}login(e){return r(this,void 0,void 0,(function*(){if(this.ongoingFRVRLogin)return this.ongoingFRVRLogin;const t={201:e=>r(this,void 0,void 0,(function*(){const t=yield e.json(),r=new st(t.accessToken,t.refreshToken);if(r.isAccessValid())return Object.assign(Object.assign({},et.LOGIN_SUCCESS),{tokenPair:r});throw et.SERVER_ERROR})),401:()=>{throw et.INVALID_CREDENTIALS},403:()=>{throw et.ACCOUNT_NOT_ACTIVE}};return this.ongoingFRVRLogin=this.fetchAndHandleCommonErrors(dt.AUTH_LOGIN,t,e),this.ongoingFRVRLogin.finally((()=>{this.ongoingFRVRLogin=null}))}))}checkVerification(e){return r(this,void 0,void 0,(function*(){const t={200:e=>r(this,void 0,void 0,(function*(){const t=yield e.json();return null==t?void 0:t.verified}))};return this.fetchAndHandleCommonErrors(dt.USER_VERIFIED,t,null,{"X-REFRESH-TOKEN":e.refreshToken})}))}initiateVerifyChallenge(e){return r(this,void 0,void 0,(function*(){const t={platform:at.FRVR,credentials:e},r={201:()=>et.OPERATION_SUCCESS,401:()=>{throw et.INVALID_CREDENTIALS}};return this.fetchAndHandleCommonErrors(dt.AUTH_VERIFY_CHALLENGE,r,t)}))}initiateRecoveryChallenge(e){return r(this,void 0,void 0,(function*(){const t={platform:at.FRVR,credentials:e},r={201:()=>et.OPERATION_SUCCESS,401:()=>{throw et.INVALID_CREDENTIALS}};return this.fetchAndHandleCommonErrors(dt.AUTH_RECOVER_CHALLENGE,r,t)}))}changePassword(e,t){return r(this,void 0,void 0,(function*(){const r={platform:at.FRVR,credentials:{newPassword:t}},s={200:()=>et.OPERATION_SUCCESS,401:()=>{throw et.INVALID_CREDENTIALS}};return this.fetchAndHandleCommonErrors(dt.AUTH_SETTINGS,s,r,{Authorization:`Bearer ${e}`})}))}refreshTokens(e){return r(this,void 0,void 0,(function*(){return this.fetchAndHandleCommonErrors(dt.AUTH_REFRESH,{201:t=>r(this,void 0,void 0,(function*(){const r=yield t.json();if(e.updateTokensIfValid(r.accessToken,r.refreshToken),e.isAccessValid())return et.OPERATION_SUCCESS;throw et.SERVER_ERROR})),401:()=>{throw et.INVALID_CREDENTIALS}},{refreshToken:e.refreshToken})}))}fetchAndHandleCommonErrors(e,t,s={},i={}){return r(this,void 0,void 0,(function*(){const{path:r,method:o}=e,n=this.apiBaseURL+r,a={method:o,headers:Object.assign({"Content-Type":"application/json"},i),body:s&&JSON.stringify(s)};let d;try{d=yield fetch(n,a)}catch(e){throw Object.assign(Object.assign({},et.NETWORK_ERROR),{payload:{error:e}})}if(!d)throw et.NETWORK_ERROR;if(t[d.status])return t[d.status](d);switch(d.status){case 400:throw et.INVALID_FORMAT;case 500:throw et.SERVER_ERROR;default:throw Object.assign(Object.assign({},et.UNKNOWN_ERROR),{payload:{status:d.status,url:e}})}}))}}class ht{constructor(e={}){var t,r,s,i;this.loginStatusListeners=[],this.proactiveRefreshTimeoutID=-1,this.logger=e.logger,this.providers=null!==(t=e.providers)&&void 0!==t?t:[],this.storage=null!==(r=e.storage)&&void 0!==r?r:c,this.serviceClient=null!==(s=e.serviceClient)&&void 0!==s?s:new ct(e),this.tokenHandler=null!==(i=e.tokenHandler)&&void 0!==i?i:new nt,this._isFRVRLoginEnabled=!this.providers.find((e=>e.prohibitsLoginWithFRVRCredentials()))}init(){return r(this,void 0,void 0,(function*(){yield this.tokenHandler.initFromStorage(this.storage);const e={loginWithProvider:this.loginWithProvider.bind(this)};let t=!1;for(const r of this.providers)if(yield r.init(e),r.getCredentials()&&!t){if(t=!0,r.handlesFRVRLogin&&r.handlesFRVRLogin())break;this.loginWithProvider(r).catch((e=>{var t;null===(t=this.logger)||void 0===t||t.warn(`Auto login with platform ${r.getPlatformId} failed!`,e)}))}!t&&this.isLoggedIn()&&this.onLoginStatusChange()}))}getAccessToken(){return this.shouldRefreshTokens()?null:this.tokenHandler.getAccessToken()}getFRVRID(){return this.isLoggedIn()?this.tokenHandler.getFRVRID():null}isVerified(){return this.tokenHandler.isVerified()}getCredentials(){if(!this.isLoggedIn())return;return Object.assign({[at.FRVR]:{userID:this.tokenHandler.getFRVRID(),accessToken:this.tokenHandler.getAccessToken(),isTokenExpired:!this.tokenHandler.isAccessValid(),isVerified:this.tokenHandler.isVerified()}},this.getThirdPartyCredentials())}getThirdPartyCredentials(){const e={};return this.providers.forEach((t=>{t&&t.isLoggedIn()&&(e[t.getPlatformId()]=t.getCredentials())})),e}isLoggedIn(){return this.tokenHandler.isAnyValid()}isLoggingIn(){return this.serviceClient.isLoggingIn()||!!this.providers.find((e=>e.isLoggingIn()))}getCurrentPlatform(){return this.tokenHandler.getCurrentPlatform()}getAvailableLoginPlatforms(){return this.providers.filter((e=>e.isLoginSupported())).map((e=>e.getPlatformId()))}isPlatformAvailable(e){return!!this.providers.find((t=>t.isLoginSupported()&&t.getPlatformId()==e))}isFRVRLoginEnabled(){return this._isFRVRLoginEnabled}isLogoutSupported(){return!this.providers.find((e=>!e.isLogoutSupported()))}addStatusChangeListener(e){this.loginStatusListeners.push(e)}registerOnFRVR(e,t=!0){return r(this,void 0,void 0,(function*(){return this.serviceClient.register(e).then((t=>this.loginToFRVR({platform:at.FRVR,credentials:e}))).catch((r=>{if(r.type==et.REG_CONFLICT.type&&t)return this.loginToFRVR({platform:at.FRVR,credentials:e});throw r}))}))}loginToFRVR(e){return r(this,void 0,void 0,(function*(){return this.serviceClient.login(e).then((e=>r(this,void 0,void 0,(function*(){if(e.tokenPair){this.tokenHandler.setAsCurrent(e.tokenPair);for(const e of this.providers)e.onFRVRTokensReceived&&(yield e.onFRVRTokensReceived(this.tokenHandler.currentPair));this.onLoginStatusChange()}return t(e,["tokenPair"])}))))}))}loginThroughPlatform(e){return r(this,void 0,void 0,(function*(){let t;if(t=e||1!=this.providers.length?this.providers.find((t=>t.getPlatformId()==e)):this.providers[0],!t)throw et.PLATFORM_NOT_AVAILABLE;return t.login().catch((e=>{throw Object.assign(Object.assign({},et.PLATFORM_LOGIN_FAIL),{payload:{platform:t.getPlatformId(),error:e}})})).then((e=>{if(e)return this.loginWithProvider(t);throw Object.assign(Object.assign({},et.PLATFORM_LOGIN_FAIL),{payload:{platform:t.getPlatformId()}})}))}))}login(e,t){return e&&t?this.loginToFRVR({platform:e,credentials:t}):this.loginThroughPlatform(e)}logout(){this.tokenHandler.deleteTokens(),this.providers.forEach((e=>{e.logout()})),this.onLoginStatusChange()}mergeAccounts(e,t){return r(this,void 0,void 0,(function*(){}))}initiateVerifyChallenge(e){return r(this,void 0,void 0,(function*(){return this.serviceClient.initiateVerifyChallenge(e)}))}initiateRecoveryChallenge(e){return r(this,void 0,void 0,(function*(){return this.serviceClient.initiateRecoveryChallenge(e)}))}changePassword(e){return r(this,void 0,void 0,(function*(){if(!this.isLoggedIn())throw et.NOT_LOGGED_IN;return this.serviceClient.changePassword(this.tokenHandler.getRefreshToken(),e)}))}synchronizeVerifiedStatus(){return r(this,void 0,void 0,(function*(){return!(!this.isVerified()&&this.isLoggedIn())||this.serviceClient.checkVerification(this.tokenHandler.currentPair).then((e=>!!e&&this.refreshCurrentPair().then((()=>!0))))}))}authenticatedFetch(e,t){return r(this,void 0,void 0,(function*(){return t=yield this.decorateRequestWithAuth(t),fetch(e,t)}))}decorateRequestWithAuth(e){return r(this,void 0,void 0,(function*(){if(this.shouldRefreshTokens()&&(yield this.refreshCurrentPair()),!this.tokenHandler.isAccessValid())throw et.NOT_LOGGED_IN;return Object.assign(Object.assign({},e),{headers:Object.assign(Object.assign({"Content-Type":"application/json"},e.headers),{Authorization:`Bearer ${this.tokenHandler.getAccessToken()}`})})}))}onLoginStatusChange(){const e=this.isLoggedIn();this.loginStatusListeners.forEach((t=>{t(e)})),this.updateProactiveRefresh()}getFreshAccessToken(){return r(this,void 0,void 0,(function*(){return this.shouldRefreshTokens()&&(yield this.refreshCurrentPair()),this.tokenHandler.getAccessToken()}))}shouldRefreshTokens(){return this.tokenHandler.shouldRefresh()}refreshTokens(e){return r(this,void 0,void 0,(function*(){const t=this.serviceClient.refreshTokens(e);return t.then((()=>{this.updateProactiveRefresh()})).catch((e=>{})),t.catch((t=>r(this,void 0,void 0,(function*(){const r=this.providers.find((t=>t.getPlatformId()==e.platform));if(t.type!=Ze.invalidCredentials||!(null==r?void 0:r.isLoggedIn()))throw this.tokenHandler.isAccessValid()?this.updateProactiveRefresh():this.logout(),t;try{return yield this.loginWithProvider(r),!0}catch(e){throw this.logout(),e}}))))}))}refreshCurrentPair(){return r(this,void 0,void 0,(function*(){return this.refreshTokens(this.tokenHandler.currentPair).then((e=>r(this,void 0,void 0,(function*(){for(const e of this.providers)e.onFRVRTokensReceived&&(yield e.onFRVRTokensReceived(this.tokenHandler.currentPair));return e}))))}))}loginWithProvider(e){return r(this,void 0,void 0,(function*(){return this.loginToFRVR({platform:null==e?void 0:e.getPlatformId(),credentials:null==e?void 0:e.getCredentials()})}))}updateProactiveRefresh(){window.clearTimeout(this.proactiveRefreshTimeoutID),this.isLoggedIn()&&(this.proactiveRefreshTimeoutID=window.setTimeout((()=>{this.refreshCurrentPair()}),1e3*this.getTimeTillProactiveRefresh()))}getTimeTillProactiveRefresh(){if(!this.tokenHandler.isRefreshValid())return Number.MAX_SAFE_INTEGER;const e=this.tokenHandler.currentPair,t=.4*(e.accessIssuedAt+e.accessLifespan-Math.floor(Date.now()/1e3));return Math.max(30,t)}get responseTypes(){return Ze}get platforms(){return at}}var lt=Object.freeze({__proto__:null});class ut extends Error{constructor(e,t){super(e),this.code=t,this.name="FeaturesClientNetworkError",this.code=t}}class gt{constructor({auth:e,gameId:t,debugProvider:r,apiUrl:s,channelId:i}){this.auth=e,this.gameId=t,this.debugProvider=r,this.baseUrl=null!=s?s:"https://crucible.frvr.com",this.channelId=i}getFeatures(){return r(this,void 0,void 0,(function*(){const e=new URLSearchParams;if(this.debugProvider){const t=yield this.debugProvider.getProperty("_overrideRemoteConfig");t&&e.append("debug",t)}this.channelId&&e.append("channel",this.channelId);let t=e.toString();t&&(t=`?${t}`);const r=`${this.baseUrl}/v1/tailor/${this.gameId}/config${t}`,s={"Content-Type":"application/json"},i=this.getUserToken();i&&(s.Authorization=`Bearer ${i}`);const o=yield fetch(r,{headers:s});if(!o.ok)throw new ut(`Failed to fetch features: ${o.status} ${o.statusText}`,o.status);return yield o.json()}))}getUserToken(){var e;return null===(e=this.auth)||void 0===e?void 0:e.getAccessToken()}}const vt="__frvr_features";class pt{constructor({client:e,auth:t,debugProvider:r,localStorage:s,logger:i,config:o,remoteABTests:n,channelId:a}){var d;this.firstFetch=!0,this.auth=t,this.client=null!=e?e:new gt({auth:t,debugProvider:r,gameId:o.gameId,apiUrl:o.apiUrl,channelId:a}),this.localStorage=s,this.logger=i,this.config=o,this.remoteABTests=n,this.defaultFeatures=null!==(d=o.defaultFeatures)&&void 0!==d?d:{}}init(){return r(this,void 0,void 0,(function*(){this.preStoredConfig=yield this.localStorage.getItem(vt)}))}getFeature(e,t=!1){return this.getFeatures([e],t).then((t=>t[e]))}getFeatures(e,t=!1){var s,i,o;return r(this,void 0,void 0,(function*(){yield this.fetchFeatures(t);const r=null!==(s=this.remoteConfig)&&void 0!==s?s:this.preStoredConfig;return this.setupGroups(null!==(i=null==r?void 0:r.groups)&&void 0!==i?i:[]),e&&0!==e.length?e.reduce(((e,t)=>{var s,i;return e[t]=null!==(i=null===(s=null==r?void 0:r.config)||void 0===s?void 0:s[t])&&void 0!==i?i:this.defaultFeatures[t],e}),{}):null!==(o=null==r?void 0:r.config)&&void 0!==o?o:this.defaultFeatures}))}getGroups(){return this.groups}setupGroups(e){var t;this.groups||(this.groups=e,e.length>0&&(null===(t=this.remoteABTests)||void 0===t||t.setGroups(e)))}fetchFeatures(e){var t;return r(this,void 0,void 0,(function*(){if(this.firstFetchPromise)return this.firstFetchPromise;if(!this.firstFetch&&!e)return;this.groups=void 0,this.firstFetch=!1;const s=this.getUserId();s&&this.preStoredConfig&&s!==this.preStoredConfig.userId&&(yield this.removePreStoredConfig());const i=null!==(t=this.config.timeout)&&void 0!==t?t:1e3;return this.firstFetchPromise=function(e,t){return new Promise(((r,s)=>{const i=setTimeout((()=>s(new Error(`Timeout after ${t}ms`))),t);e.then((e=>{clearTimeout(i),r(e)})).catch((e=>{clearTimeout(i),s(e)}))}))}((()=>r(this,void 0,void 0,(function*(){let e;try{e=yield this.client.getFeatures()}catch(e){this.logger.error(`Failed to fetch features: ${e.code} ${e.message}`);e instanceof ut&&404===e.code&&(yield this.removePreStoredConfig())}return e&&(yield this.savePreStoredConfig(e)),e})))(),i).then((e=>{this.remoteConfig=e,this.firstFetchPromise=void 0})).catch((e=>{this.logger.error(`Failed to fetch features: ${e.message}`),this.firstFetchPromise=void 0})),this.firstFetchPromise}))}savePreStoredConfig(e){const t=Object.assign(Object.assign({},e),{userId:this.getUserId()});return this.localStorage.setItem(vt,t)}removePreStoredConfig(){return this.preStoredConfig=void 0,this.localStorage.removeItem(vt)}getUserId(){return this.auth.getFRVRID()}}class ft{constructor(e){this.tracker=e}setGroups(e){var t;const r=this.getTrackerPlaySessionId();if(r===this.playSessionId)return;if(null===(t=this.contextRemoveFn)||void 0===t||t.call(this),0===e.length)return;this.playSessionId=r;const s=function(e){const t={};for(const r of e){const e=0===r.groupId?"control":r.groupId<=26?String.fromCharCode(96+r.groupId):`${r.groupId}`;t[r.testName]=`${r.testName}__${e}`}return t}(e),i=function(e,t){const r={};for(const s in t)r[`${e}_${s}`]=t[s];return r}("abt",s);for(const e in s){const t=s[e];this.tracker.logValuedEvent("ab_test_activation",1,{ab_test_name:e,ab_test_group:t})}this.contextRemoveFn=this.tracker.addExtraFieldFunction((e=>{Object.assign(e,i)}))}getTrackerPlaySessionId(){return this.tracker.getPlaySessionId()}}class mt{constructor(e,t){this.primaryDebugProvider=e,this.fallbackStorageProvider=t}getProperty(e){var t;return r(this,void 0,void 0,(function*(){const r=yield null===(t=this.primaryDebugProvider)||void 0===t?void 0:t.getProperty(e);return void 0===r?this.fallbackStorageProvider.getItem(e):r}))}}function It(e){window.addEventListener("focus",(()=>{e.onShow()})),window.addEventListener("blur",(()=>{e.onHide()}))}function yt(e){window.addEventListener("focus",(()=>{e.onAudioResume(),e.onResume()})),window.addEventListener("blur",(()=>{e.onSuspend(),e.onAudioSuspend()}))}const Pt={providers:[{name:"dev",type:"interstitial",priority:1},{name:"dev",type:"reward",priority:2}],throttling:{maxfrequency:5e3}},St={onGamePause:()=>{},onSuspend:()=>{},onResume:()=>{},onAudioSuspend:()=>{},onAudioResume:()=>{},onShow:()=>{},onHide:()=>{}};class Et{constructor(e,t,r,s,i){this.bootstrapper=e,this.postInit=t,this.preComplete=r,this.postComplete=s,this.consentProvider=i}init(){return this.consentProvider.consentToTerms(),this.bootstrapper.init().then((()=>this.postInit()))}setProgress(e){this.bootstrapper.setProgress(e)}complete(){return this.preComplete().then((()=>this.bootstrapper.complete())).then((()=>this.postComplete()))}}class bt{init(){return r(this,void 0,void 0,(function*(){}))}getId(){return"empty"}onModulesUpdated(e){}setConfig(e){}getLogger(){return console}getBootstrapper(){return l}getConsentProvider(){return m}getAnalyticsProviders(){return[]}getAnalyticsIDProvider(){return oe}getABTestsUniqueId(){return""}getAdsProviders(e){return[]}getIAPProvider(){return Te}getLocalStorageProvider(){return h([d.providerName])}getCloudStorageProvider(){return r(this,void 0,void 0,(function*(){return h([d.providerName])}))}getShortcutProvider(){return g}getTrackerContextProvider(){return()=>({})}getNotificationsProvider(){return Me}getCrossplay(){return p}getSocialProvider(){return W}getLiveRoomProvider(){return Z}getTournamentsProvider(){return ze}getChallengesProvider(){return Xe}getProfile(){return y}getAuthProviders(e,t){return[]}getCharacteristics(){return P}getEntryPointProvider(){return S}getCommunityProvider(){return E}getAdsConfig(e){return r(this,void 0,void 0,(function*(){return e}))}getNavigationProvider(){return b}}class _t extends bt{getId(){return"dev"}getAdsProviders(e){return[new j,new x]}getIAPProvider(){return new Le}getLocalStorageProvider(){return h([a.providerName,d.providerName])}getCloudStorageProvider(){return r(this,void 0,void 0,(function*(){return h([a.providerName,d.providerName])}))}getTrackerContextProvider(){return ce("")}}function Tt(e){const t=Object.getOwnPropertyNames(bt.prototype),r={};for(const s of t)"constructor"!==s&&e[s]&&(r[s]=e[s].bind(e));return r}function Rt(...e){const t={},r=e.filter((e=>e)).map(Tt);return Object.assign(t,...r),t}class Ct{constructor(e){this.shortcutProvider=e}init(){return this.shortcutProvider.init()}canCreateShortcut(){return this.shortcutProvider.canCreateShortcut()}createShortcut(){return this.shortcutProvider.createShortcut()}canCreateShortcutAsync(){return this.canCreateShortcut()}createShortcutAsync(){return this.createShortcut()}}class At{constructor(){this.lifecycle=Object.assign({},St),this.config={}}setChannel(e){if(this.channel){if(this.initPromise)return void this.logger.error("[FRVR-SDK] channel cannot be set after init");this.logger.warn("[FRVR-SDK] setting channel multiple times")}this.channel=e}init(t=e.Env.DEVELOPMENT){var r;return this.channel=this.buildChannelByEnv(this.channel,t),null===(r=this.logger)||void 0===r||r.log("[FRVR-SDK - init] config:",this.config),this.channel.setConfig(this.config),this.buildComponents(t),this.initPromise=this.channel.init().then((()=>this.initTracker())).then((()=>this.initComponents(t))),this.initPromise}buildChannelByEnv(r,s){const i=s===e.Env.DEVELOPMENT?new _t:new bt;if(!r)return i;if(s===e.Env.DEVELOPMENT){r=Rt(i,t(Tt(r),["getAnalyticsProviders","getCloudStorageProvider","getNotificationsProvider"]))}else r=Rt(i,r);return r}buildComponents(t){var r,s,n,a,d,c,h,l,u,g,v,p,f,m,I;this.logger||(this.logger=t===e.Env.PRODUCTION&&i||this.channel.getLogger()),this.channel.onModulesUpdated(this),this.logger.debug("[FRVR-SDK] building components"),this.entrypoint=this.channel.getEntryPointProvider(),this.localStorage||(this.localStorage=new o({provider:this.channel.getLocalStorageProvider(this.config.storage),logger:this.logger})),this.channel.onModulesUpdated(this),this.consentProvider=this.channel.getConsentProvider(),this.tracker||(this.tracker=new ge({storage:this.localStorage,logger:this.logger,analyticsProviders:this.channel.getAnalyticsProviders((null===(r=this.config.tracker)||void 0===r?void 0:r.analyticsProviders)||{}),idProvider:this.channel.getAnalyticsIDProvider(this.localStorage),contextProvider:this.channel.getTrackerContextProvider((null===(s=this.config.tracker)||void 0===s?void 0:s.trackerChannelId)||(null===(n=this.channel)||void 0===n?void 0:n.getId())),consentProvider:this.consentProvider,appContextFields:{context:(null===(a=this.config.tracker)||void 0===a?void 0:a.gameId)||this.config.gameId,app_version:null===(d=this.config.tracker)||void 0===d?void 0:d.appVersion,app_build:null===(c=this.config.tracker)||void 0===c?void 0:c.appBuild}})),this.abTests||(this.abTests=new fe({tracker:this.tracker,logger:this.logger})),this.channel.onModulesUpdated(this),this.ads||(this.ads=new B({logger:this.logger,storage:this.localStorage,tracker:this.tracker,controls:this.lifecycle,onBeforeInit:()=>this.registerAdsProviders()})),this.notifications||(this.notifications=new je({logger:this.logger,provider:this.channel.getNotificationsProvider(),tracker:this.tracker})),this.bootstrapper||(this.bootstrapper=new Et(this.channel.getBootstrapper(),(()=>this.postInit(t)),(()=>this.preComplete()),(()=>this.postComplete()),this.consentProvider)),this.shortcut||(this.shortcut=new Ct(this.channel.getShortcutProvider())),this.crossplay||(this.crossplay=this.channel.getCrossplay(this.tracker)),this.auth||(this.auth=new ht({providers:this.channel.getAuthProviders(this.config.gameId,this.config.auth),storage:this.localStorage,env:t,config:this.config.auth,logger:this.logger})),this.iap||(this.iap=new Fe({provider:this.channel.getIAPProvider(new De({env:t,auth:this.auth,channelId:null===(h=this.channel)||void 0===h?void 0:h.getId(),gameId:this.config.gameId,apiHostOverride:null===(l=this.config.iap)||void 0===l?void 0:l.hostOverride})),tracker:this.tracker,logger:this.logger}));const y=Object.assign(Object.assign({},this.config.features),{gameId:null!==(g=null===(u=this.config.features)||void 0===u?void 0:u.gameId)&&void 0!==g?g:this.config.gameId}),P=this.entrypoint.getProperty?this.entrypoint:void 0,S=new mt(P,this.localStorage);this.features||(this.features=new pt({logger:this.logger,auth:this.auth,debugProvider:S,localStorage:this.localStorage,remoteABTests:new ft(this.tracker),config:y,channelId:null===(v=this.channel)||void 0===v?void 0:v.getId()}));const E=Object.assign(Object.assign({env:t},this.config.social),{gameId:null!==(f=null===(p=this.config.social)||void 0===p?void 0:p.gameId)&&void 0!==f?f:this.config.gameId});this.social||(this.social=new Q(E,{logger:this.logger,provider:this.channel.getSocialProvider(),auth:this.auth})),this.liveRoom||(this.liveRoom=new ee({logger:this.logger,provider:this.channel.getLiveRoomProvider(),auth:this.auth})),this.tournaments||(this.tournaments=new Ye({logger:this.logger,provider:this.channel.getTournamentsProvider(),auth:this.auth})),this.challenges=new Je({logger:this.logger,provider:this.channel.getChallengesProvider()}),this.profile||(this.profile=this.channel.getProfile()),this.channelCharacteristics||(this.channelCharacteristics=this.channel.getCharacteristics()),this.community||(this.community=this.channel.getCommunityProvider());const b=Object.assign(Object.assign({},this.config.navigation),{gameId:null!==(I=null===(m=this.config.navigation)||void 0===m?void 0:m.gameId)&&void 0!==I?I:this.config.gameId});this.navigation||(this.navigation=this.channel.getNavigationProvider(b))}initTracker(){return r(this,void 0,void 0,(function*(){yield this.tracker.init(),this.tracker.logEvent("page_loading",{})}))}initComponents(e){return r(this,void 0,void 0,(function*(){this.logger.debug("[FRVR-SDK] initialising components"),this.addDefaultListeners(e),yield this.configAds(e),this.config.gameId?(this.notifications.configure({game:this.config.gameId}),this.tournaments.init(this.config.gameId,e)):this.logger.error("[FRVR-SDK] Missing game's name in configuration"),this.crossplay.needsConfiguration()&&(this.config.crossplay?this.crossplay.configure(this.config.crossplay):this.logger.error("[FRVR-SDK] Missing crossplay configuration"))}))}postInit(e){var t,s;return r(this,void 0,void 0,(function*(){this.logger.debug("[FRVR-SDK] post init"),yield this.initPromise;const i=null===(s=null===(t=this.config.ads)||void 0===t?void 0:t.autoInit)||void 0===s||s;yield Promise.all([(()=>r(this,void 0,void 0,(function*(){let t;try{t=yield this.channel.getCloudStorageProvider(this.auth,this.config.cloudStorage,e)}catch(e){this.logger.error("[FRVR-SDK] error initialising cloud storage",e)}this.cloudStorage=new o({provider:t||new d,logger:this.logger})})))(),i&&this.ads.init(),(()=>r(this,void 0,void 0,(function*(){yield this.iap.init(),yield this.iap.configure(this.config.iap)})))(),this.shortcut.init(),this.notifications.init(),this.auth.init(),this.features.init(),(()=>r(this,void 0,void 0,(function*(){this.config.gameId?yield this.challenges.init(this.config.gameId,this.entrypoint,e):this.logger.error("[FRVR-SDK] Missing game's name in configuration")})))()])}))}preComplete(){return r(this,void 0,void 0,(function*(){this.logger.debug("[FRVR-SDK] pre complete");yield(()=>r(this,void 0,void 0,(function*(){var e,t;const r=this.channel.getABTestsUniqueId()||this.tracker.getGlobalUserId();yield null===(t=(e=this.abTests).init)||void 0===t?void 0:t.call(e,r,this.config.abTests)})))(),this.tracker.loaded()}))}postComplete(){return r(this,void 0,void 0,(function*(){this.logger.debug("[FRVR-SDK] post complete"),this.tracker.logEvent("device_info",{})}))}addDefaultListeners(t){this.logger.debug("[FRVR-SDK] adding default listeners"),"undefined"!=typeof window&&It(this.lifecycle),t===e.Env.DEVELOPMENT&&yt(this.lifecycle)}configAds(t){var s,i,o,n;return r(this,void 0,void 0,(function*(){if(!(null===(i=null===(s=this.config.ads)||void 0===s?void 0:s.autoInit)||void 0===i||i))return void this.logger.debug("[FRVR-SDK] ads auto init disabled, skipping setup");this.logger.debug("[FRVR-SDK] fetching remote ads config if available");const r=yield null===(n=(o=this.channel).getAdsConfig)||void 0===n?void 0:n.call(o,this.config.ads);r&&(this.config.ads=r),this.config.ads&&(this.logger.debug("[FRVR-SDK] configuring ads"),this.ads.configure(this.config.ads)),t!==e.Env.DEVELOPMENT||this.config.ads||(this.logger.debug("[FRVR-SDK] configuring ads for dev"),this.ads.configure(Pt))}))}registerAdsProviders(){var e;return r(this,void 0,void 0,(function*(){this.logger.debug("[FRVR-SDK] registering ads providers");const t=this.channel.getAdsProviders(null!==(e=this.config.ads)&&void 0!==e?e:{});for(const e of t)this.ads.register(e)}))}}return window.FRVR=new At,e.ACCESS_TOKEN_KEY=ot,e.AdTracker=k,e.AdTypeProperties=T,e.Ads=B,e.AdsDevInterstitial=j,e.AdsDevReward=x,e.AdsThrottler=M,e.AsyncStorage=o,e.Auth=ht,e.DEFAULT_ADS_CONFIG=Pt,e.Deferred=class extends Promise{constructor(e){let t,r;super(((e,s)=>{t=e,r=s})),this._resolve=t,this._reject=r,null==e||e(t,r)}resolve(e){this._resolve(e)}reject(e){this._reject(e)}},e.FRVRABTests=fe,e.FRVRAnalytics=class{constructor({legacyAnalytics:e,disableSendBeacon:t}={}){this.legacyAnalytics=null!=e?e:se(void 0,t)}init(e,t){return this.legacyAnalytics.init(e,t)}getName(){return this.legacyAnalytics.getName()}send(e,t,r,s){this.legacyAnalytics.send(e,t,r,s)}},e.FRVRSDK=At,e.IAP=Fe,e.IAPError=we,e.IAPMockProvider=Le,e.IAPPurchaseErrorCancelledByUser=ke,e.IAPPurchaseErrorUnknownProduct=Oe,e.IAPServiceClient=De,e.IsReadyStateManager=class{constructor(e,t){this.states={},this._isReady=!1,this.requiredStates=e,this.handler=t;for(const e of this.requiredStates)this.states[e]=!1;this.updateIsReady()}updateIsReady(){const e=this._isReady;this._isReady=this.requiredStates.every((e=>this.states[e])),e!=this._isReady&&this.handler(this._isReady)}setState(e,t){this.states[e]=t,this.updateIsReady()}getState(e){return this.states[e]}get isReady(){return this._isReady}},e.MIN_PROACTIVE_REFRESH_INTERVAL=30,e.MemoryAsyncStorageProvider=d,e.Notifications=je,e.PROACTIVE_REFRESH_THRESHOLD=.6,e.PublicCredentials=lt,e.PublicResponses=tt,e.REFRESH_TOKEN_KEY=it,e.StorageIDProvider=class extends de{setCanUseCookies(){this.canUseCookies=!1}},e.TokenHandler=nt,e.Tracker=ge,e.WebIDProvider=de,e.WebLocalStorageProvider=a,e.addDefaultWebListeners=It,e.addDevWebListeners=yt,e.buildStorageProvider=h,e.buildTrackerWebContextProvider=ce,e.buildWebAsyncStorage=e=>new o({provider:new a,logger:e}),e.consentToAllConsentProvider=I,e.defaultCharacteristics=P,e.defaultLifecycle=St,e.emptyAdEventLogger=C,e.emptyAdLifecycle=R,e.emptyAnalyticsIDProvider=oe,e.emptyAsyncStorage=c,e.emptyBootstrapper=l,e.emptyCommunityProvider=E,e.emptyCrossplay=p,e.emptyEntryPoint=S,e.emptyIAPProvider=Te,e.emptyLogger=i,e.emptyNavigationProvider=b,e.emptyNotificationsProvider=Me,e.emptyProfile=y,e.emptyShortcutProvider=g,e.inMemoryChannelMapper=_e,e.noConsentConsentProvider=m,Object.defineProperty(e,"__esModule",{value:!0}),e}({});FRVRSDK.version=FRVRSDK.version||{},FRVRSDK.version.sdk=FRVRSDK.version.sdk||{},FRVRSDK.version.sdk.v="13.9.1",FRVRSDK.version.sdk.bts="1699364228384",FRVRSDK.version.sdk.branch="master";
//# sourceMappingURL=frvr-sdk.min.js.map
